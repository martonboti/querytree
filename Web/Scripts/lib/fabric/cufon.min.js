/*!
 * Copyright (c) 2009 Simo Kinnunen.
 * Licensed under the MIT license.
 */
var Cufon=function(){function v(n){var t=this.face=n.face;this.glyphs=n.glyphs;this.w=n.w;this.baseSize=parseInt(t["units-per-em"],10);this.family=t["font-family"].toLowerCase();this.weight=t["font-weight"];this.style=t["font-style"]||"normal";this.viewBox=function(){var i=t.bbox.split(/\s+/),n={minX:parseInt(i[0],10),minY:parseInt(i[1],10),maxX:parseInt(i[2],10),maxY:parseInt(i[3],10)};return n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")},n}();this.ascent=-parseInt(t.ascent,10);this.descent=-parseInt(t.descent,10);this.height=-this.ascent+this.descent}function y(){var n={},t={oblique:"italic",italic:"oblique"};this.add=function(t){(n[t.style]||(n[t.style]={}))[t.weight]=t};this.get=function(i,r){var f=n[i]||n[t[i]]||n.normal||n.italic||n.oblique,s,h,e,o,u;if(!f)return null;if(r={normal:400,bold:700}[r]||parseInt(r,10),f[r])return f[r];s={1:1,99:0}[r%100];h=[];s===undefined&&(s=r>400);r==500&&(r=400);for(u in f)u=parseInt(u,10),(!e||u<e)&&(e=u),(!o||u>o)&&(o=u),h.push(u);return r<e&&(r=e),r>o&&(r=o),h.sort(function(n,t){return(s?n>r&&t>r?n<t:n>t:n<r&&t<r?n>t:n<t)?-1:1}),f[h[0]]}}function p(){function f(n,t){return n.contains?n.contains(t):n.compareDocumentPosition(t)&16}function t(n){var t=n.relatedTarget;t&&!f(this,t)&&u(this)}function i(){u(this)}function u(t){setTimeout(function(){n.replace(t,a.get(t).options,!0)},10)}this.attach=function(n){n.onmouseenter===undefined?(r(n,"mouseover",t),r(n,"mouseout",t)):(r(n,"mouseenter",i),r(n,"mouseleave",i))}}function w(){function i(n){return n.cufid||(n.cufid=++t)}var n={},t=0;this.get=function(t){var r=i(t);return n[r]||(n[r]={})}}function b(n){var i={},r={};this.get=function(t){return i[t]!=undefined?i[t]:n[t]};this.getSize=function(n,i){return r[n]||(r[n]=new t.Size(this.get(n),i))};this.extend=function(n){for(var t in n)i[t]=n[t];return this}}function r(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,function(){return i.call(n,fabric.window.event)})}function k(n,t){var i=a.get(n);return i.options?n:(t.hover&&t.hoverables[n.nodeName.toLowerCase()]&&tt.attach(n),i.options=t,n)}function e(n){var t={};return function(i){return t.hasOwnProperty(i)||(t[i]=n.apply(null,arguments)),t[i]}}function d(n,r){var f,e,u,o;for(r||(r=t.getStyle(n)),f=t.quotedList(r.get("fontFamily").toLowerCase()),u=0,o=f.length;u<o;++u)if(e=f[u],i[e])return i[e].get(r.get("fontStyle"),r.get("fontWeight"));return null}function o(n){return fabric.document.getElementsByTagName(n)}function s(){for(var i={},t,n=0,r=arguments.length;n<r;++n)for(t in arguments[n])i[t]=arguments[n][t];return i}function g(n,i,r,f,e,o){var l=f.separate,s,c;if(l=="none")return u[f.engine].apply(null,arguments);var v=fabric.document.createDocumentFragment(),a,h=i.split(it[l]),y=l=="words";for(y&&nt&&(/^\s/.test(i)&&h.unshift(""),/\s$/.test(i)&&h.push("")),s=0,c=h.length;s<c;++s)a=u[f.engine](n,y?t.textAlign(h[s],r,s,c):h[s],r,f,e,o,s<c-1),a&&v.appendChild(a);return v}function l(n,i){for(var o,h,f,e,c,s,r=k(n,i).firstChild;r;r=c){if(c=r.nextSibling,s=!1,r.nodeType==1){if(!r.firstChild)continue;if(/cufon/.test(r.className))s=!0;else{arguments.callee(r,i);continue}}if(e||(e=t.getStyle(n).extend(i)),f||(f=d(n,e)),f){if(s){u[i.engine](f,null,e,i,r,n);continue}(o=r.data,typeof G_vmlCanvasManager!="undefined"&&(o=o.replace(/\r/g,"\n")),o!=="")&&(h=g(f,o,e,i,r,n),h?r.parentNode.replaceChild(h,r):r.parentNode.removeChild(r))}}}var n=function(){return n.replace.apply(null,arguments)},c=n.DOM={ready:function(){var t=!1,u={loaded:1,complete:1},i=[],n=function(){if(!t){t=!0;for(var n;n=i.shift();n());}};return fabric.document.addEventListener&&(fabric.document.addEventListener("DOMContentLoaded",n,!1),fabric.window.addEventListener("pageshow",n,!1)),!fabric.window.opera&&fabric.document.readyState&&function(){u[fabric.document.readyState]?n():setTimeout(arguments.callee,10)}(),fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left");n()}catch(t){setTimeout(arguments.callee,1)}}(),r(fabric.window,"load",n),function(r){arguments.length?t?r():i.push(r):n()}}()},t=n.CSS={Size:function(n,t){this.value=parseFloat(n);this.unit=String(n).match(/[a-z%]*$/)[0]||"px";this.convert=function(n){return n/t*this.value};this.convertFrom=function(n){return n/this.value*t};this.toString=function(){return this.value+this.unit}},getStyle:function(n){return new b(n.style)},quotedList:e(function(n){for(var i=[],r=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,t;t=r.exec(n);)i.push(t[3]||t[1]);return i}),ready:function(){var n=!1,t=[],r=function(){n=!0;for(var i;i=t.shift();i());},u=Object.prototype.propertyIsEnumerable?o("style"):{length:0},i=o("link");return c.ready(function(){for(var f=0,n,t=0,e=i.length;n=i[t],t<e;++t)n.disabled||n.rel.toLowerCase()!="stylesheet"||++f;fabric.document.styleSheets.length>=u.length+f?r():setTimeout(arguments.callee,10)}),function(i){n?i():t.push(i)}}(),supports:function(n,t){var i=fabric.document.createElement("span").style;return i[n]===undefined?!1:(i[n]=t,i[n]===t)},textAlign:function(n,t,i,r){return t.get("textAlign")=="right"?i>0&&(n=" "+n):i<r-1&&(n+=" "),n},textDecoration:function(n,t){var i,r,f,u;for(t||(t=this.getStyle(n)),i={underline:null,overline:null,"line-through":null},r=n;r.parentNode&&r.parentNode.nodeType==1;){f=!0;for(u in i)i[u]||(t.get("textDecoration").indexOf(u)!=-1&&(i[u]=t.get("color")),f=!1);if(f)break;t=this.getStyle(r=r.parentNode)}return i},textShadow:e(function(n){if(n=="none")return null;for(var r=[],t={},i,u=0,f=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;i=f.exec(n);)i[0]==","?(r.push(t),t={},u=0):i[1]?t.color=i[1]:t[["offX","offY","blur"][u++]]=i[2];return r.push(t),r}),color:e(function(n){var t={};return t.color=n.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(n,i,r){return t.opacity=parseFloat(r),"rgb("+i+")"}),t}),textTransform:function(n,t){return n[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[t.get("textTransform")]||"toString"]()}},nt=" ".split(/\s+/).length==0,a=new w,tt=new p,h=[],u={},i={},f={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(n){return jQuery(n)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(n){return $$(n)}||fabric.window.$&&function(n){return $(n)}||fabric.document.querySelectorAll&&function(n){return fabric.document.querySelectorAll(n)}||o,separate:"words",textShadow:"none"},it={words:/\s+/,characters:""};return n.now=function(){return c.ready(),n},n.refresh=function(){for(var i=h.splice(0,h.length),t=0,r=i.length;t<r;++t)n.replace.apply(null,i[t]);return n},n.registerEngine=function(t,i){return i?(u[t]=i,n.set("engine",t)):n},n.registerFont=function(t){var u=new v(t),r=u.family;return i[r]||(i[r]=new y),i[r].add(u),n.set("fontFamily",'"'+r+'"')},n.replace=function(i,r,u){return(r=s(f,r),!r.engine)?n:(typeof r.textShadow=="string"&&r.textShadow&&(r.textShadow=t.textShadow(r.textShadow)),u||h.push(arguments),(i.nodeType||typeof i=="string")&&(i=[i]),t.ready(function(){for(var u,t=0,f=i.length;t<f;++t)u=i[t],typeof u=="string"?n.replace(r.selector(u),r,!0):l(u,r)}),n)},n.replaceElement=function(n,i){return i=s(f,i),typeof i.textShadow=="string"&&i.textShadow&&(i.textShadow=t.textShadow(i.textShadow)),l(n,i)},n.engines=u,n.fonts=i,n.getOptions=function(){return s(f)},n.set=function(t,i){return f[t]=i,n},n}();Cufon.registerEngine("canvas",function(){function u(n,t){var f=0,e=0,u=[],s=/([mrvxe])([^a-z]*)/g,o,r,i;n:for(r=0;o=s.exec(n);++r){i=o[2].split(",");switch(o[1]){case"v":u[r]={m:"bezierCurveTo",a:[f+~~i[0],e+~~i[1],f+~~i[2],e+~~i[3],f+=~~i[4],e+=~~i[5]]};break;case"r":u[r]={m:"lineTo",a:[f+=~~i[0],e+=~~i[1]]};break;case"m":u[r]={m:"moveTo",a:[f=~~i[0],e=~~i[1]]};break;case"x":u[r]={m:"closePath",a:[]};break;case"e":break n}t[u[r].m].apply(t,u[r].a)}return u}function f(n,t){for(var r,i=0,u=n.length;i<u;++i)r=n[i],t[r.m].apply(t,r.a)}var t=Cufon.CSS.supports("display","inline-block"),r=!t&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId)),n=fabric.document.createElement("style"),i;n.type="text/css";i=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(r?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(t?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{n.appendChild(i)}catch(e){n.setAttribute("type","text/css");n.styleSheet.cssText=i.data}return fabric.document.getElementsByTagName("head")[0].appendChild(n),function(n,i,r,e,o){function ei(){var u,o,p,f;s.save();s.fillStyle=e.backgroundColor;var r=0,t=0,i=[{left:0}];for(e.textAlign==="right"?(s.translate(c[t],0),i[0].left=c[t]*l):e.textAlign==="center"&&(s.translate(c[t]/2,0),i[0].left=c[t]/2*l),u=0,o=y.length;u<o;++u){if(y[u]==="\n"){t++;var h=-n.ascent-n.ascent/5*e.lineHeight,w=i[i.length-1],v={left:0};w.width=r*l;w.height=(-n.ascent+n.descent)*l;e.textAlign==="right"?(s.translate(-a,h),s.translate(c[t],0),v.left=c[t]*l):e.textAlign==="center"?(s.translate(-r-c[t-1]/2,h),s.translate(c[t]/2,0),v.left=c[t]/2*l):s.translate(-r,h);i.push(v);r=0;continue}(p=n.glyphs[y[u]]||n.missingGlyph,p)&&(f=Number(p.w||n.w)+k,e.backgroundColor&&(s.save(),s.translate(0,n.ascent),s.fillRect(0,0,f+10,-n.ascent+n.descent),s.restore()),s.translate(f,0),r+=f,u==o-1&&(i[i.length-1].width=r*l,i[i.length-1].height=(-n.ascent+n.descent)*l))}s.restore();Cufon.textOptions.boundaries=i}function ri(t){var l,o,v,w,p,i,h;for(s.fillStyle=t||Cufon.textOptions.color||r.get("color"),l=0,o=0,e.textAlign==="right"?s.translate(c[o],0):e.textAlign==="center"&&s.translate(c[o]/2,0),v=0,w=y.length;v<w;++v){if(y[v]==="\n"){o++;p=-n.ascent-n.ascent/5*e.lineHeight;e.textAlign==="right"?(s.translate(-a,p),s.translate(c[o],0)):e.textAlign==="center"?(s.translate(-l-c[o-1]/2,p),s.translate(c[o]/2,0)):s.translate(-l,p);l=0;continue}(i=n.glyphs[y[v]]||n.missingGlyph,i)&&(h=Number(i.w||n.w)+k,tt&&(s.save(),s.strokeStyle=s.fillStyle,s.lineWidth+=s.lineWidth,s.beginPath(),tt.underline&&(s.moveTo(0,-n.face["underline-position"]+.5),s.lineTo(h,-n.face["underline-position"]+.5)),tt.overline&&(s.moveTo(0,n.ascent+.5),s.lineTo(h,n.ascent+.5)),tt["line-through"]&&(s.moveTo(0,-n.descent+.5),s.lineTo(h,-n.descent+.5)),s.stroke(),s.restore()),yt&&(s.save(),s.transform(1,0,-.25,1,0,0)),s.beginPath(),i.d&&(i.code?f(i.code,s):i.code=u("m"+i.d,s)),s.fill(),e.strokeStyle&&(s.closePath(),s.save(),s.lineWidth=e.strokeWidth,s.strokeStyle=e.strokeStyle,s.stroke(),s.restore()),yt&&s.restore(),s.translate(h,0),l+=h)}}var pt=i===null,g=n.viewBox,v=r.getSize("fontSize",n.baseSize),k=r.get("letterSpacing"),lt,c,p,w,ot,s,l,ii,tt,yt,h,d,ut;k=k=="normal"?0:v.convertFrom(parseInt(k,10));var it=0,wt=0,rt=0,b=e.textShadow,nt=[];if(Cufon.textOptions.shadowOffsets=[],Cufon.textOptions.shadows=null,b)for(Cufon.textOptions.shadows=b,h=0,d=b.length;h<d;++h){var ut=b[h],ui=v.convertFrom(parseFloat(ut.offX)),fi=v.convertFrom(parseFloat(ut.offY));nt[h]=[ui,fi]}var y=Cufon.CSS.textTransform(pt?o.alt:i,r).split(""),a=0,ht=null,ct=0,ft=1,et=[];for(h=0,d=y.length;h<d;++h){if(y[h]==="\n"){ft++;a>ct&&(ct=a);et.push(a);a=0;continue}(lt=n.glyphs[y[h]]||n.missingGlyph,lt)&&(a+=ht=Number(lt.w||n.w)+k)}for(et.push(a),a=Math.max(ct,a),c=[],h=et.length;h--;)c[h]=a-et[h];if(ht===null)return null;wt+=g.width-ht;rt+=g.minX;pt?(p=o,w=o.firstChild):(p=fabric.document.createElement("span"),p.className="cufon cufon-canvas",p.alt=i,w=fabric.document.createElement("canvas"),p.appendChild(w),e.printable&&(ot=fabric.document.createElement("span"),ot.className="cufon-alt",ot.appendChild(fabric.document.createTextNode(i)),p.appendChild(ot)));var st=p.style,bt=w.style||{},kt=v.convert(g.height-it+0),at=Math.ceil(kt),dt=at/kt;w.width=Math.ceil(v.convert(a+wt-rt)*dt);w.height=at;it+=g.minY;bt.top=Math.round(v.convert(it-n.ascent))+"px";bt.left=Math.round(v.convert(rt))+"px";var gt=Math.ceil(v.convert(a*dt)),ni=gt+"px",vt=v.convert(n.height),ti=(e.lineHeight-1)*v.convert(-n.ascent/5)*(ft-1);for(Cufon.textOptions.width=gt,Cufon.textOptions.height=vt*ft+ti,Cufon.textOptions.lines=ft,Cufon.textOptions.totalLineHeight=ti,t?(st.width=ni,st.height=vt+"px"):(st.paddingLeft=ni,st.paddingBottom=vt-1+"px"),s=Cufon.textOptions.context||w.getContext("2d"),l=at/g.height,Cufon.textOptions.fontAscent=n.ascent*l,Cufon.textOptions.boundaries=null,ii=Cufon.textOptions.shadowOffsets,h=nt.length;h--;)ii[h]=[nt[h][0]*l,nt[h][1]*l];if(s.save(),s.scale(l,l),s.translate(-rt-1/l*w.width/2+(Cufon.fonts[n.family].offsetLeft||0),-it-Cufon.textOptions.height/l/2+(Cufon.fonts[n.family].offsetTop||0)),s.lineWidth=n.face["underline-thickness"],s.save(),tt=Cufon.getTextDecoration(e),yt=e.fontStyle==="italic",s.save(),ei(),b)for(h=0,d=b.length;h<d;++h)ut=b[h],s.save(),s.translate.apply(s,nt[h]),ri(ut.color),s.restore();return ri(),s.restore(),s.restore(),s.restore(),p}}());Cufon.registerEngine("vml",function(){function r(n,t){return i(n,/(?:em|ex|%)$/i.test(t)?"1em":t)}function i(n,t){var i,r,u;return/px$/i.test(t)?parseFloat(t):(i=n.style.left,r=n.runtimeStyle.left,n.runtimeStyle.left=n.currentStyle.left,n.style.left=t,u=n.style.pixelLeft,n.style.left=i,n.runtimeStyle.left=r,u)}var n,t;if(fabric.document.namespaces)return(n=fabric.document.createElement("canvas"),n&&n.getContext&&n.getContext.apply)?void 0:(fabric.document.namespaces.cvml==null&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),t=fabric.document.createElement("cvml:shape"),t.style.behavior="url(#default#VML)",!t.coordsize)?void 0:(t=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}<\/style>'),function(n,t,u,f,e,o,s){var nt=t===null,c,p,k,st;nt&&(t=e.alt);var b=n.viewBox,v=u.computedFontSize||(u.computedFontSize=new Cufon.CSS.Size(r(o,u.get("fontSize"))+"px",n.baseSize)),y=u.computedLSpacing;y==undefined&&(y=u.get("letterSpacing"),u.computedLSpacing=y=y=="normal"?0:~~v.convertFrom(i(o,y)));nt?(c=e,p=e.firstChild):(c=fabric.document.createElement("span"),c.className="cufon cufon-vml",c.alt=t,p=fabric.document.createElement("span"),p.className="cufon-vml-canvas",c.appendChild(p),f.printable&&(k=fabric.document.createElement("span"),k.className="cufon-alt",k.appendChild(fabric.document.createTextNode(t)),c.appendChild(k)),s||c.appendChild(fabric.document.createElement("cvml:shape")));var ct=c.style,tt=p.style,lt=v.convert(b.height),it=Math.ceil(lt),at=it/lt,rt=b.minX,vt=b.minY;tt.height=it;tt.top=Math.round(v.convert(vt-n.ascent));tt.left=Math.round(v.convert(rt));ct.height=v.convert(n.height)+"px";for(var ui=Cufon.getTextDecoration(f),ni=u.get("color"),ut=Cufon.CSS.textTransform(t,u).split(""),ft=0,yt=0,et=null,l,h,ot=f.textShadow,w=0,pt=0,wt=ut.length;w<wt;++w)l=n.glyphs[ut[w]]||n.missingGlyph,l&&(ft+=et=~~(l.w||n.w)+y);if(et===null)return null;var bt=-rt+ft+(b.width-et),ti=v.convert(bt*at),ii=Math.round(ti),kt=bt+","+b.height,dt,ri="r"+kt+"nsnf";for(w=0;w<wt;++w)if(l=n.glyphs[ut[w]]||n.missingGlyph,l){if(nt?(h=p.childNodes[pt],h.firstChild&&h.removeChild(h.firstChild)):(h=fabric.document.createElement("cvml:shape"),p.appendChild(h)),h.stroked="f",h.coordsize=kt,h.coordorigin=dt=rt-yt+","+vt,h.path=(l.d?"m"+l.d+"xe":"")+"m"+dt+ri,h.fillcolor=ni,st=h.style,st.width=ii,st.height=it,ot){var ht=ot[0],d=ot[1],gt=Cufon.CSS.color(ht.color),g,a=fabric.document.createElement("cvml:shadow");a.on="t";a.color=gt.color;a.offset=ht.offX+","+ht.offY;d&&(g=Cufon.CSS.color(d.color),a.type="double",a.color2=g.color,a.offset2=d.offX+","+d.offY);a.opacity=gt.opacity||g&&g.opacity||1;h.appendChild(a)}yt+=~~(l.w||n.w)+y;++pt}return ct.width=Math.max(Math.ceil(v.convert(ft*at)),0),c})}());Cufon.getTextDecoration=function(n){return{underline:n.textDecoration==="underline",overline:n.textDecoration==="overline","line-through":n.textDecoration==="line-through"}};typeof exports!="undefined"&&(exports.Cufon=Cufon);