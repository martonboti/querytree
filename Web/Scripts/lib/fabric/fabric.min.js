/*! Fabric.js Copyright 2008-2012, Bitsonnet (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"0.8.13"},Cufon;typeof exports!="undefined"&&(exports.fabric=fabric);typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head><\/head><body><\/body><\/html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;this.JSON||(this.JSON={}),function(){function i(n){return n<10?"0"+n:n}function o(n){return e.lastIndex=0,e.test(n)?'"'+n.replace(e,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function u(i,f){var c,l,s,a,v=n,h,e=f[i];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(i));typeof t=="function"&&(e=t.call(f,i,e));switch(typeof e){case"string":return o(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(n+=r,h=[],Object.prototype.toString.apply(e)==="[object Array]"){for(a=e.length,c=0;c<a;c+=1)h[c]=u(c,e)||"null";return s=h.length===0?"[]":n?"[\n"+n+h.join(",\n"+n)+"\n"+v+"]":"["+h.join(",")+"]",n=v,s}if(t&&typeof t=="object")for(a=t.length,c=0;c<a;c+=1)l=t[c],typeof l=="string"&&(s=u(l,e),s&&h.push(o(l)+(n?": ":":")+s));else for(l in e)Object.hasOwnProperty.call(e,l)&&(s=u(l,e),s&&h.push(o(l)+(n?": ":":")+s));return s=h.length===0?"{}":n?"{\n"+n+h.join(",\n"+n)+"\n"+v+"}":"{"+h.join(",")+"}",n=v,s}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,r,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",r="",typeof e=="number")for(o=0;o<e;o+=1)r+=" ";else typeof e=="string"&&(r=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return u("",{"":i})});typeof JSON.parse!="function"&&(JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),f.lastIndex=0,f.test(n)&&(n=n.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}();
/*!
 * Copyright (c) 2009 Simo Kinnunen.
 * Licensed under the MIT license.
 */
Cufon=function(){function v(n){var t=this.face=n.face;this.glyphs=n.glyphs;this.w=n.w;this.baseSize=parseInt(t["units-per-em"],10);this.family=t["font-family"].toLowerCase();this.weight=t["font-weight"];this.style=t["font-style"]||"normal";this.viewBox=function(){var i=t.bbox.split(/\s+/),n={minX:parseInt(i[0],10),minY:parseInt(i[1],10),maxX:parseInt(i[2],10),maxY:parseInt(i[3],10)};return n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")},n}();this.ascent=-parseInt(t.ascent,10);this.descent=-parseInt(t.descent,10);this.height=-this.ascent+this.descent}function y(){var n={},t={oblique:"italic",italic:"oblique"};this.add=function(t){(n[t.style]||(n[t.style]={}))[t.weight]=t};this.get=function(i,r){var f=n[i]||n[t[i]]||n.normal||n.italic||n.oblique,s,h,e,o,u;if(!f)return null;if(r={normal:400,bold:700}[r]||parseInt(r,10),f[r])return f[r];s={1:1,99:0}[r%100];h=[];s===undefined&&(s=r>400);r==500&&(r=400);for(u in f)u=parseInt(u,10),(!e||u<e)&&(e=u),(!o||u>o)&&(o=u),h.push(u);return r<e&&(r=e),r>o&&(r=o),h.sort(function(n,t){return(s?n>r&&t>r?n<t:n>t:n<r&&t<r?n>t:n<t)?-1:1}),f[h[0]]}}function p(){function f(n,t){return n.contains?n.contains(t):n.compareDocumentPosition(t)&16}function t(n){var t=n.relatedTarget;t&&!f(this,t)&&u(this)}function i(){u(this)}function u(t){setTimeout(function(){n.replace(t,a.get(t).options,!0)},10)}this.attach=function(n){n.onmouseenter===undefined?(r(n,"mouseover",t),r(n,"mouseout",t)):(r(n,"mouseenter",i),r(n,"mouseleave",i))}}function w(){function i(n){return n.cufid||(n.cufid=++t)}var n={},t=0;this.get=function(t){var r=i(t);return n[r]||(n[r]={})}}function b(n){var i={},r={};this.get=function(t){return i[t]!=undefined?i[t]:n[t]};this.getSize=function(n,i){return r[n]||(r[n]=new t.Size(this.get(n),i))};this.extend=function(n){for(var t in n)i[t]=n[t];return this}}function r(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,function(){return i.call(n,fabric.window.event)})}function k(n,t){var i=a.get(n);return i.options?n:(t.hover&&t.hoverables[n.nodeName.toLowerCase()]&&tt.attach(n),i.options=t,n)}function e(n){var t={};return function(i){return t.hasOwnProperty(i)||(t[i]=n.apply(null,arguments)),t[i]}}function d(n,r){var f,e,u,o;for(r||(r=t.getStyle(n)),f=t.quotedList(r.get("fontFamily").toLowerCase()),u=0,o=f.length;u<o;++u)if(e=f[u],i[e])return i[e].get(r.get("fontStyle"),r.get("fontWeight"));return null}function o(n){return fabric.document.getElementsByTagName(n)}function s(){for(var i={},t,n=0,r=arguments.length;n<r;++n)for(t in arguments[n])i[t]=arguments[n][t];return i}function g(n,i,r,f,e,o){var l=f.separate,s,c;if(l=="none")return u[f.engine].apply(null,arguments);var v=fabric.document.createDocumentFragment(),a,h=i.split(it[l]),y=l=="words";for(y&&nt&&(/^\s/.test(i)&&h.unshift(""),/\s$/.test(i)&&h.push("")),s=0,c=h.length;s<c;++s)a=u[f.engine](n,y?t.textAlign(h[s],r,s,c):h[s],r,f,e,o,s<c-1),a&&v.appendChild(a);return v}function l(n,i){for(var o,h,f,e,c,s,r=k(n,i).firstChild;r;r=c){if(c=r.nextSibling,s=!1,r.nodeType==1){if(!r.firstChild)continue;if(/cufon/.test(r.className))s=!0;else{arguments.callee(r,i);continue}}if(e||(e=t.getStyle(n).extend(i)),f||(f=d(n,e)),f){if(s){u[i.engine](f,null,e,i,r,n);continue}(o=r.data,typeof G_vmlCanvasManager!="undefined"&&(o=o.replace(/\r/g,"\n")),o!=="")&&(h=g(f,o,e,i,r,n),h?r.parentNode.replaceChild(h,r):r.parentNode.removeChild(r))}}}var n=function(){return n.replace.apply(null,arguments)},c=n.DOM={ready:function(){var t=!1,u={loaded:1,complete:1},i=[],n=function(){if(!t){t=!0;for(var n;n=i.shift();n());}};return fabric.document.addEventListener&&(fabric.document.addEventListener("DOMContentLoaded",n,!1),fabric.window.addEventListener("pageshow",n,!1)),!fabric.window.opera&&fabric.document.readyState&&function(){u[fabric.document.readyState]?n():setTimeout(arguments.callee,10)}(),fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left");n()}catch(t){setTimeout(arguments.callee,1)}}(),r(fabric.window,"load",n),function(r){arguments.length?t?r():i.push(r):n()}}()},t=n.CSS={Size:function(n,t){this.value=parseFloat(n);this.unit=String(n).match(/[a-z%]*$/)[0]||"px";this.convert=function(n){return n/t*this.value};this.convertFrom=function(n){return n/this.value*t};this.toString=function(){return this.value+this.unit}},getStyle:function(n){return new b(n.style)},quotedList:e(function(n){for(var i=[],r=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,t;t=r.exec(n);)i.push(t[3]||t[1]);return i}),ready:function(){var n=!1,t=[],r=function(){n=!0;for(var i;i=t.shift();i());},u=Object.prototype.propertyIsEnumerable?o("style"):{length:0},i=o("link");return c.ready(function(){for(var f=0,n,t=0,e=i.length;n=i[t],t<e;++t)n.disabled||n.rel.toLowerCase()!="stylesheet"||++f;fabric.document.styleSheets.length>=u.length+f?r():setTimeout(arguments.callee,10)}),function(i){n?i():t.push(i)}}(),supports:function(n,t){var i=fabric.document.createElement("span").style;return i[n]===undefined?!1:(i[n]=t,i[n]===t)},textAlign:function(n,t,i,r){return t.get("textAlign")=="right"?i>0&&(n=" "+n):i<r-1&&(n+=" "),n},textDecoration:function(n,t){var i,r,f,u;for(t||(t=this.getStyle(n)),i={underline:null,overline:null,"line-through":null},r=n;r.parentNode&&r.parentNode.nodeType==1;){f=!0;for(u in i)i[u]||(t.get("textDecoration").indexOf(u)!=-1&&(i[u]=t.get("color")),f=!1);if(f)break;t=this.getStyle(r=r.parentNode)}return i},textShadow:e(function(n){if(n=="none")return null;for(var r=[],t={},i,u=0,f=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;i=f.exec(n);)i[0]==","?(r.push(t),t={},u=0):i[1]?t.color=i[1]:t[["offX","offY","blur"][u++]]=i[2];return r.push(t),r}),color:e(function(n){var t={};return t.color=n.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(n,i,r){return t.opacity=parseFloat(r),"rgb("+i+")"}),t}),textTransform:function(n,t){return n[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[t.get("textTransform")]||"toString"]()}},nt=" ".split(/\s+/).length==0,a=new w,tt=new p,h=[],u={},i={},f={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(n){return jQuery(n)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(n){return $$(n)}||fabric.window.$&&function(n){return $(n)}||fabric.document.querySelectorAll&&function(n){return fabric.document.querySelectorAll(n)}||o,separate:"words",textShadow:"none"},it={words:/\s+/,characters:""};return n.now=function(){return c.ready(),n},n.refresh=function(){for(var i=h.splice(0,h.length),t=0,r=i.length;t<r;++t)n.replace.apply(null,i[t]);return n},n.registerEngine=function(t,i){return i?(u[t]=i,n.set("engine",t)):n},n.registerFont=function(t){var u=new v(t),r=u.family;return i[r]||(i[r]=new y),i[r].add(u),n.set("fontFamily",'"'+r+'"')},n.replace=function(i,r,u){return(r=s(f,r),!r.engine)?n:(typeof r.textShadow=="string"&&r.textShadow&&(r.textShadow=t.textShadow(r.textShadow)),u||h.push(arguments),(i.nodeType||typeof i=="string")&&(i=[i]),t.ready(function(){for(var u,t=0,f=i.length;t<f;++t)u=i[t],typeof u=="string"?n.replace(r.selector(u),r,!0):l(u,r)}),n)},n.replaceElement=function(n,i){return i=s(f,i),typeof i.textShadow=="string"&&i.textShadow&&(i.textShadow=t.textShadow(i.textShadow)),l(n,i)},n.engines=u,n.fonts=i,n.getOptions=function(){return s(f)},n.set=function(t,i){return f[t]=i,n},n}();Cufon.registerEngine("canvas",function(){function u(n,t){var f=0,e=0,u=[],s=/([mrvxe])([^a-z]*)/g,o,r,i;n:for(r=0;o=s.exec(n);++r){i=o[2].split(",");switch(o[1]){case"v":u[r]={m:"bezierCurveTo",a:[f+~~i[0],e+~~i[1],f+~~i[2],e+~~i[3],f+=~~i[4],e+=~~i[5]]};break;case"r":u[r]={m:"lineTo",a:[f+=~~i[0],e+=~~i[1]]};break;case"m":u[r]={m:"moveTo",a:[f=~~i[0],e=~~i[1]]};break;case"x":u[r]={m:"closePath",a:[]};break;case"e":break n}t[u[r].m].apply(t,u[r].a)}return u}function f(n,t){for(var r,i=0,u=n.length;i<u;++i)r=n[i],t[r.m].apply(t,r.a)}var t=Cufon.CSS.supports("display","inline-block"),r=!t&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId)),n=fabric.document.createElement("style"),i;n.type="text/css";i=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(r?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(t?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{n.appendChild(i)}catch(e){n.setAttribute("type","text/css");n.styleSheet.cssText=i.data}return fabric.document.getElementsByTagName("head")[0].appendChild(n),function(n,i,r,e,o){function oi(){var u,o,p,f;s.save();s.fillStyle=e.backgroundColor;var r=0,t=0,i=[{left:0}];for(e.textAlign==="right"?(s.translate(c[t],0),i[0].left=c[t]*l):e.textAlign==="center"&&(s.translate(c[t]/2,0),i[0].left=c[t]/2*l),u=0,o=y.length;u<o;++u){if(y[u]==="\n"){t++;var h=-n.ascent-n.ascent/5*e.lineHeight,w=i[i.length-1],v={left:0};w.width=r*l;w.height=(-n.ascent+n.descent)*l;e.textAlign==="right"?(s.translate(-a,h),s.translate(c[t],0),v.left=c[t]*l):e.textAlign==="center"?(s.translate(-r-c[t-1]/2,h),s.translate(c[t]/2,0),v.left=c[t]/2*l):s.translate(-r,h);i.push(v);r=0;continue}(p=n.glyphs[y[u]]||n.missingGlyph,p)&&(f=Number(p.w||n.w)+k,e.backgroundColor&&(s.save(),s.translate(0,n.ascent),s.fillRect(0,0,f+10,-n.ascent+n.descent),s.restore()),s.translate(f,0),r+=f,u==o-1&&(i[i.length-1].width=r*l,i[i.length-1].height=(-n.ascent+n.descent)*l))}s.restore();Cufon.textOptions.boundaries=i}function ei(t){var l,o,v,w,p,i,h;for(s.fillStyle=t||Cufon.textOptions.color||r.get("color"),l=0,o=0,e.textAlign==="right"?s.translate(c[o],0):e.textAlign==="center"&&s.translate(c[o]/2,0),v=0,w=y.length;v<w;++v){if(y[v]==="\n"){o++;p=-n.ascent-n.ascent/5*e.lineHeight;e.textAlign==="right"?(s.translate(-a,p),s.translate(c[o],0)):e.textAlign==="center"?(s.translate(-l-c[o-1]/2,p),s.translate(c[o]/2,0)):s.translate(-l,p);l=0;continue}(i=n.glyphs[y[v]]||n.missingGlyph,i)&&(h=Number(i.w||n.w)+k,ft&&(s.save(),s.strokeStyle=s.fillStyle,s.lineWidth+=s.lineWidth,s.beginPath(),ft.underline&&(s.moveTo(0,-n.face["underline-position"]+.5),s.lineTo(h,-n.face["underline-position"]+.5)),ft.overline&&(s.moveTo(0,n.ascent+.5),s.lineTo(h,n.ascent+.5)),ft["line-through"]&&(s.moveTo(0,-n.descent+.5),s.lineTo(h,-n.descent+.5)),s.stroke(),s.restore()),kt&&(s.save(),s.transform(1,0,-.25,1,0,0)),s.beginPath(),i.d&&(i.code?f(i.code,s):i.code=u("m"+i.d,s)),s.fill(),e.strokeStyle&&(s.closePath(),s.save(),s.lineWidth=e.strokeWidth,s.strokeStyle=e.strokeStyle,s.stroke(),s.restore()),kt&&s.restore(),s.translate(h,0),l+=h)}}var dt=i===null,tt=n.viewBox,v=r.getSize("fontSize",n.baseSize),k=r.get("letterSpacing"),pt,c,p,w,ct,s,l,fi,ft,kt,h,nt,ot;k=k=="normal"?0:v.convertFrom(parseInt(k,10));var d=0,et=0,at=0,g=0,b=e.textShadow,it=[];if(Cufon.textOptions.shadowOffsets=[],Cufon.textOptions.shadows=null,b)for(Cufon.textOptions.shadows=b,h=0,nt=b.length;h<nt;++h){var ot=b[h],rt=v.convertFrom(parseFloat(ot.offX)),ut=v.convertFrom(parseFloat(ot.offY));it[h]=[rt,ut];ut<d&&(d=ut);rt>et&&(et=rt);ut>at&&(at=ut);rt<g&&(g=rt)}var y=Cufon.CSS.textTransform(dt?o.alt:i,r).split(""),a=0,vt=null,yt=0,st=1,ht=[];for(h=0,nt=y.length;h<nt;++h){if(y[h]==="\n"){st++;a>yt&&(yt=a);ht.push(a);a=0;continue}(pt=n.glyphs[y[h]]||n.missingGlyph,pt)&&(a+=vt=Number(pt.w||n.w)+k)}for(ht.push(a),a=Math.max(yt,a),c=[],h=ht.length;h--;)c[h]=a-ht[h];if(vt===null)return null;et+=tt.width-vt;g+=tt.minX;dt?(p=o,w=o.firstChild):(p=fabric.document.createElement("span"),p.className="cufon cufon-canvas",p.alt=i,w=fabric.document.createElement("canvas"),p.appendChild(w),e.printable&&(ct=fabric.document.createElement("span"),ct.className="cufon-alt",ct.appendChild(fabric.document.createTextNode(i)),p.appendChild(ct)));var lt=p.style,gt=w.style||{},ni=v.convert(tt.height-d+at),wt=Math.ceil(ni),ti=wt/ni;w.width=Math.ceil(v.convert(a+et-g)*ti);w.height=wt;d+=tt.minY;gt.top=Math.round(v.convert(d-n.ascent))+"px";gt.left=Math.round(v.convert(g))+"px";var ii=Math.ceil(v.convert(a*ti)),ri=ii+"px",bt=v.convert(n.height),ui=(e.lineHeight-1)*v.convert(-n.ascent/5)*(st-1);for(Cufon.textOptions.width=ii,Cufon.textOptions.height=bt*st+ui,Cufon.textOptions.lines=st,Cufon.textOptions.totalLineHeight=ui,t?(lt.width=ri,lt.height=bt+"px"):(lt.paddingLeft=ri,lt.paddingBottom=bt-1+"px"),s=Cufon.textOptions.context||w.getContext("2d"),l=wt/tt.height,Cufon.textOptions.fontAscent=n.ascent*l,Cufon.textOptions.boundaries=null,fi=Cufon.textOptions.shadowOffsets,h=it.length;h--;)fi[h]=[it[h][0]*l,it[h][1]*l];if(s.save(),s.scale(l,l),s.translate(-g-1/l*w.width/2+(Cufon.fonts[n.family].offsetLeft||0),-d-Cufon.textOptions.height/l/2),s.lineWidth=n.face["underline-thickness"],s.save(),ft=Cufon.getTextDecoration(e),kt=e.fontStyle==="italic",b)for(h=0,nt=b.length;h<nt;++h)ot=b[h],s.save(),s.translate.apply(s,it[h]),ei(ot.color),s.restore();return s.save(),oi(),ei(),s.restore(),s.restore(),s.restore(),p}}());Cufon.registerEngine("vml",function(){function r(n,t){return i(n,/(?:em|ex|%)$/i.test(t)?"1em":t)}function i(n,t){var i,r,u;return/px$/i.test(t)?parseFloat(t):(i=n.style.left,r=n.runtimeStyle.left,n.runtimeStyle.left=n.currentStyle.left,n.style.left=t,u=n.style.pixelLeft,n.style.left=i,n.runtimeStyle.left=r,u)}var n,t;if(fabric.document.namespaces)return(n=fabric.document.createElement("canvas"),n&&n.getContext&&n.getContext.apply)?void 0:(fabric.document.namespaces.cvml==null&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),t=fabric.document.createElement("cvml:shape"),t.style.behavior="url(#default#VML)",!t.coordsize)?void 0:(t=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}<\/style>'),function(n,t,u,f,e,o,s){var nt=t===null,c,p,k,st;nt&&(t=e.alt);var b=n.viewBox,v=u.computedFontSize||(u.computedFontSize=new Cufon.CSS.Size(r(o,u.get("fontSize"))+"px",n.baseSize)),y=u.computedLSpacing;y==undefined&&(y=u.get("letterSpacing"),u.computedLSpacing=y=y=="normal"?0:~~v.convertFrom(i(o,y)));nt?(c=e,p=e.firstChild):(c=fabric.document.createElement("span"),c.className="cufon cufon-vml",c.alt=t,p=fabric.document.createElement("span"),p.className="cufon-vml-canvas",c.appendChild(p),f.printable&&(k=fabric.document.createElement("span"),k.className="cufon-alt",k.appendChild(fabric.document.createTextNode(t)),c.appendChild(k)),s||c.appendChild(fabric.document.createElement("cvml:shape")));var ct=c.style,tt=p.style,lt=v.convert(b.height),it=Math.ceil(lt),at=it/lt,rt=b.minX,vt=b.minY;tt.height=it;tt.top=Math.round(v.convert(vt-n.ascent));tt.left=Math.round(v.convert(rt));ct.height=v.convert(n.height)+"px";for(var ui=Cufon.getTextDecoration(f),ni=u.get("color"),ut=Cufon.CSS.textTransform(t,u).split(""),ft=0,yt=0,et=null,l,h,ot=f.textShadow,w=0,pt=0,wt=ut.length;w<wt;++w)l=n.glyphs[ut[w]]||n.missingGlyph,l&&(ft+=et=~~(l.w||n.w)+y);if(et===null)return null;var bt=-rt+ft+(b.width-et),ti=v.convert(bt*at),ii=Math.round(ti),kt=bt+","+b.height,dt,ri="r"+kt+"nsnf";for(w=0;w<wt;++w)if(l=n.glyphs[ut[w]]||n.missingGlyph,l){if(nt?(h=p.childNodes[pt],h.firstChild&&h.removeChild(h.firstChild)):(h=fabric.document.createElement("cvml:shape"),p.appendChild(h)),h.stroked="f",h.coordsize=kt,h.coordorigin=dt=rt-yt+","+vt,h.path=(l.d?"m"+l.d+"xe":"")+"m"+dt+ri,h.fillcolor=ni,st=h.style,st.width=ii,st.height=it,ot){var ht=ot[0],d=ot[1],gt=Cufon.CSS.color(ht.color),g,a=fabric.document.createElement("cvml:shadow");a.on="t";a.color=gt.color;a.offset=ht.offX+","+ht.offY;d&&(g=Cufon.CSS.color(d.color),a.type="double",a.color2=g.color,a.offset2=d.offX+","+d.offY);a.opacity=gt.opacity||g&&g.opacity||1;h.appendChild(a)}yt+=~~(l.w||n.w)+y;++pt}return ct.width=Math.max(Math.ceil(v.convert(ft*at)),0),c})}());Cufon.getTextDecoration=function(n){return{underline:n.textDecoration==="underline",overline:n.textDecoration==="overline","line-through":n.textDecoration==="line-through"}};typeof exports!="undefined"&&(exports.Cufon=Cufon);fabric.log=function(){};fabric.warn=function(){};typeof console!="undefined"&&(typeof console.log!="undefined"&&console.log.apply&&(fabric.log=function(){return console.log.apply(console,arguments)}),typeof console.warn!="undefined"&&console.warn.apply&&(fabric.warn=function(){return console.warn.apply(console,arguments)}));fabric.Observable={observe:function(n,t){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in n)this.observe(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t)},stopObserving:function(n,t){this.__eventListeners||(this.__eventListeners={});this.__eventListeners[n]&&fabric.util.removeFromArray(this.__eventListeners[n],t)},fire:function(n,t){var i,r,u;if(this.__eventListeners||(this.__eventListeners={}),i=this.__eventListeners[n],i)for(r=0,u=i.length;r<u;r++)i[r](t||{})}},function(){function i(n,t){var i=n.indexOf(t);return i!==-1&&n.splice(i,1),n}function r(n,t){return Math.floor(Math.random()*(t-n+1))+n}function u(n){return n*t}function f(n,t){return parseFloat(Number(n).toFixed(t))}function e(){return!1}function o(t){t||(t={});var u=+new Date,r=t.duration||500,f=u+r,i,o=t.onChange||function(){},s=t.abort||function(){return!1},h=t.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},e="startValue"in t?t.startValue:0,c="endValue"in t?t.endValue:100;byValue=t.byValue||c-e;t.onStart&&t.onStart(),function l(){if(i=+new Date,currentTime=i>f?r:i-u,o(h(currentTime,e,byValue,r)),i>f||s()){t.onComplete&&t.onComplete();return}n(l)}()}function s(n,t,i){if(n){var r=new Image;r.onload=function(){t&&t.call(i,r);r=r.onload=null};r.src=n}else t&&t.call(i,n)}var t,n;fabric.util={};t=Math.PI/180;n=function(){return fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){fabric.window.setTimeout(n,1e3/60)}}();fabric.util.removeFromArray=i;fabric.util.degreesToRadians=u;fabric.util.toFixed=f;fabric.util.getRandomInt=r;fabric.util.falseFunction=e;fabric.util.animate=o;fabric.util.requestAnimFrame=n;fabric.util.loadImage=s}(),function(){function t(t,i){for(var u=n.call(arguments,2),f=[],r=0,e=t.length;r<e;r++)f[r]=u.length?t[r][i].apply(t[r],u):t[r][i].call(t[r]);return f}function i(n,t){if(!n||n.length===0)return undefined;var i=n.length-1,r=t?n[i][t]:n[i];if(t)while(i--)n[i][t]>=r&&(r=n[i][t]);else while(i--)n[i]>=r&&(r=n[i]);return r}function r(n,t){if(!n||n.length===0)return undefined;var i=n.length-1,r=t?n[i][t]:n[i];if(t)while(i--)n[i][t]<r&&(r=n[i][t]);else while(i--)n[i]<r&&(r=n[i]);return r}var n=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)i in this&&n.call(t,this[i],i,this)});Array.prototype.map||(Array.prototype.map=function(n,t){for(var r=[],i=0,u=this.length>>>0;i<u;i++)i in this&&(r[i]=n.call(t,this[i],i,this));return r});Array.prototype.every||(Array.prototype.every=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u=[],r,i=0,f=this.length>>>0;i<f;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u});Array.prototype.reduce||(Array.prototype.reduce=function(n){var r=this.length>>>0,t=0,i;if(arguments.length>1)i=arguments[1];else do{if(t in this){i=this[t++];break}if(++t>=r)throw new TypeError;}while(1);for(;t<r;t++)t in this&&(i=n.call(null,i,this[t],t,this));return i});fabric.util.array={invoke:t,min:r,max:i}}(),function(){function n(n,t){for(var i in t)n[i]=t[i];return n}function t(t){return n({},t)}fabric.util.object={extend:n,clone:t}}(),function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}function i(n){return n.replace("&","&amp;").replace('"',"&quot;").replace("'","&apos;").replace("<","&lt;").replace(">","&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:n,capitalize:t,escapeXml:i}}(),function(){var t=Array.prototype.slice,i=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var f=this,e=t.call(arguments,1),u;return u=e.length?function(){return i.call(f,this instanceof n?this:r,e.concat(t.call(arguments)))}:function(){return i.call(f,this instanceof n?this:r,arguments)},n.prototype=this.prototype,u.prototype=new n,u})}(),function(){function t(){}function f(){function u(){this.initialize.apply(this,arguments)}var f=null,e=i.call(arguments,0),o,s;for(typeof e[0]=="function"&&(f=e.shift()),u.superclass=f,u.subclasses=[],f&&(t.prototype=f.prototype,u.prototype=new t,f.subclasses.push(u)),o=0,s=e.length;o<s;o++)n(u,e[o]);return u.prototype.initialize||(u.prototype.initialize=r),u.prototype.constructor=u,u}var i=Array.prototype.slice,r=function(){},u=function(){for(var n in{toString:1})if(n==="toString")return!1;return!0}(),n;n=u?function(n,t){t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString);t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf);for(var i in t)n.prototype[i]=t[i]}:function(n,t){for(var i in t)n.prototype[i]=t[i]};fabric.util.createClass=f}(),function(){function i(n){for(var i=Array.prototype.slice.call(arguments,1),r,u=i.length,t=0;t<u;t++)if(r=typeof n[i[t]],!/^(?:function|object|unknown)$/.test(r))return!1;return!0}function c(n,t){return{handler:t,wrappedHandler:l(n,t)}}function l(n,t){return function(i){t.call(e(n),i||fabric.window.event)}}function a(t,i){return function(r){var f,u,e;if(n[t]&&n[t][i])for(f=n[t][i],u=0,e=f.length;u<e;u++)f[u].call(this,r||fabric.window.event)}}function p(n){return{x:s(n),y:h(n)}}function s(n){var t=fabric.document.documentElement,i=fabric.document.body||{scrollLeft:0};return n.pageX||(typeof n.clientX!="unknown"?n.clientX:0)+(t.scrollLeft||i.scrollLeft)-(t.clientLeft||0)}function h(n){var t=fabric.document.documentElement,i=fabric.document.body||{scrollTop:0};return n.pageY||(typeof n.clientY!="unknown"?n.clientY:0)+(t.scrollTop||i.scrollTop)-(t.clientTop||0)}var r=function(){if(typeof fabric.document.documentElement.uniqueID!="undefined")return function(n){return n.uniqueID};var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),e,o;(function(){var n={};e=function(t){return n[t]};o=function(t,i){n[t]=i}})();var v=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),y=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={},u,f;v?(u=function(n,t,i){n.addEventListener(t,i,!1)},f=function(n,t,i){n.removeEventListener(t,i,!1)}):y?(u=function(n,i,u){var f=r(n),e;o(f,n);t[f]||(t[f]={});t[f][i]||(t[f][i]=[]);e=c(f,u);t[f][i].push(e);n.attachEvent("on"+i,e.wrappedHandler)},f=function(n,i,u){var f=r(n),o,e,s;if(t[f]&&t[f][i])for(e=0,s=t[f][i].length;e<s;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f=r(t),e;n[f]||(n[f]={});n[f][i]||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=a(f,i));n[f][i].push(u)},f=function(t,i,u){var o=r(t),e,f,s;if(n[o]&&n[o][i])for(e=n[o][i],f=0,s=e.length;f<s;f++)e[f]===u&&e.splice(f,1)});fabric.util.addListener=u;fabric.util.removeListener=f;fabric.isTouchSupported&&(s=function(n){return n.touches&&n.touches[0]&&n.touches[0].pageX},h=function(n){return n.touches&&n.touches[0]&&n.touches[0].pageY});fabric.util.getPointer=p;fabric.util.object.extend(fabric.util,fabric.Observable)}(this),function(){function u(t,i){var u=t.style,r,f;if(typeof i=="string")return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)r==="opacity"?n(t,i[r]):(f=r==="float"||r==="cssFloat"?typeof u.styleFloat=="undefined"?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),f=typeof t.style.opacity=="string",e=typeof t.style.filter=="string",i=fabric.document.defaultView,o=i&&typeof i.getComputedStyle!="undefined",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};f?n=function(n,t){return n.style.opacity=t,n}:e&&(n=function(n,t){var i=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(i.zoom=1),r.test(i.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",i.filter=i.filter.replace(r,t)):i.filter+=" alpha(opacity="+t*100+")",n});fabric.util.setStyle=u}(),function(){function u(n){return typeof n=="string"?fabric.document.getElementById(n):n}function n(n){return r.call(n,0)}function i(n,t){var r=fabric.document.createElement(n);for(var i in t)i==="class"?r.className=t[i]:i==="for"?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function f(n,t){(" "+n.className+" ").indexOf(" "+t+" ")===-1&&(n.className+=(n.className?" ":"")+t)}function e(n,t,r){return typeof t=="string"&&(t=i(t,r)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function o(n){var t=0,i=0;do t+=n.offsetTop||0,i+=n.offsetLeft||0,n=n.offsetParent;while(n);return{left:i,top:t}}var r=Array.prototype.slice,t;try{t=n(fabric.document.childNodes)instanceof Array}catch(s){}t||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i}),function(){function i(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function r(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),t?n.style[t]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i;fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.type="text/javascript";i.setAttribute("runat","server");i.onload=i.onreadystatechange=function(n){if(r){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;r=!1;t(n||fabric.window.event);i=i.onload=i.onreadystatechange=null}};i.src=n;u.appendChild(i)}fabric.util.getScript=n}();fabric.util.getById=u;fabric.util.toArray=n;fabric.util.makeElement=i;fabric.util.addClass=f;fabric.util.wrapElement=e;fabric.util.getElementOffset=o}(),function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function i(){}function r(r,u){u||(u={});var e=u.method?u.method.toUpperCase():"GET",s=u.onComplete||function(){},f=t(),o;return f.onreadystatechange=function(){f.readyState===4&&(s(f),f.onreadystatechange=i)},e==="GET"&&(o=null,typeof u.parameters=="string"&&(r=n(r,u.parameters))),f.open(e,r,!0),(e==="POST"||e==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(o),f}var t=function(){for(var i,n=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=n.length;t--;)try{if(i=n[t](),i)return n[t]}catch(r){}}();fabric.util.request=r}(),function(){function i(n,t,i,r){return i*(n/=r)*n+t}function r(n,t,i,r){return-i*(n/=r)*(n-2)+t}function u(n,t,i,r){return(n/=r/2)<1?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t}function f(n,t,i,r){return i*(n/=r)*n*n+t}function e(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function o(n,t,i,r){return(n/=r/2)<1?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function s(n,t,i,r){return i*(n/=r)*n*n*n+t}function h(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function c(n,t,i,r){return(n/=r/2)<1?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function l(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function a(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function v(n,t,i,r){return(n/=r/2)<1?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function y(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function p(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function w(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function b(n,t,i,r){return n==0?t:i*Math.pow(2,10*(n/r-1))+t}function k(n,t,i,r){return n==r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function d(n,t,i,r){return n==0?t:n==r?t+i:(n/=r/2)<1?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t}function g(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function nt(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function tt(n,t,i,r){return(n/=r/2)<1?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function it(n,t,i,r){var e=1.70158,u=0,f=i;return n==0?t:(n/=r)==1?t+i:(u||(u=r*.3),f<Math.abs(i)?(f=i,e=u/4):e=u/(2*Math.PI)*Math.asin(i/f),-(f*Math.pow(2,10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/u))+t)}function rt(n,t,i,r){var e=1.70158,u=0,f=i;return n==0?t:(n/=r)==1?t+i:(u||(u=r*.3),f<Math.abs(i)?(f=i,e=u/4):e=u/(2*Math.PI)*Math.asin(i/f),f*Math.pow(2,-10*n)*Math.sin((n*r-e)*2*Math.PI/u)+i+t)}function ut(n,t,i,r){var e=1.70158,u=0,f=i;return n==0?t:(n/=r/2)==2?t+i:(u||(u=r*.3*1.5),f<Math.abs(i)?(f=i,e=u/4):e=u/(2*Math.PI)*Math.asin(i/f),n<1)?-.5*f*Math.pow(2,10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/u)+t:f*Math.pow(2,-10*(n-=1))*Math.sin((n*r-e)*2*Math.PI/u)*.5+i+t}function ft(n,t,i,r,u){return u==undefined&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function et(n,t,i,r,u){return u==undefined&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ot(n,t,i,r,u){return(u==undefined&&(u=1.70158),(n/=r/2)<1)?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function t(t,i,r,u){return r-n(u-t,0,r,u)+i}function n(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function st(i,r,u,f){return i<f/2?t(i*2,0,u,f)*.5+r:n(i*2-f,0,u,f)*.5+u*.5+r}fabric.util.ease={};fabric.util.ease={easeInQuad:i,easeOutQuad:r,easeInOutQuad:u,easeInCubic:f,easeOutCubic:e,easeInOutCubic:o,easeInQuart:s,easeOutQuart:h,easeInOutQuart:c,easeInQuint:l,easeOutQuint:a,easeInOutQuint:v,easeInSine:y,easeOutSine:p,easeInOutSine:w,easeInExpo:b,easeOutExpo:k,easeInOutExpo:d,easeInCirc:g,easeOutCirc:nt,easeInOutCirc:tt,easeInElastic:it,easeOutElastic:rt,easeInOutElastic:ut,easeInBack:ft,easeOutBack:et,easeInOutBack:ot,easeInBounce:t,easeOutBounce:n,easeInOutBounce:st}}(),function(n){"use strict";function s(n,r){var u,o,s,e;if(n)return s={},n.parentNode&&/^g$/i.test(n.parentNode.nodeName)&&(s=t.parseAttributes(n.parentNode,r)),e=r.reduce(function(i,r){return u=n.getAttribute(r),o=parseFloat(u),u&&((r==="fill"||r==="stroke")&&u==="none"&&(u=""),r==="fill-rule"&&(u=u==="evenodd"?"destination-over":u),r==="transform"&&(u=t.parseTransformAttribute(u)),r in f&&(r=f[r]),i[r]=isNaN(o)?u:o),i},{}),e=i(e,i(v(n),t.parseStyleAttribute(n))),i(s,e)}function h(n){var f,i,u,t,r;if(!n)return null;if(n=n.trim(),f=n.indexOf(",")>-1,n=n.split(/\s+/),i=[],f)for(t=0,r=n.length;t<r;t++)u=n[t].split(","),i.push({x:parseFloat(u[0]),y:parseFloat(u[1])});else for(t=0,r=n.length;t<r;t+=2)i.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return i.length%2!=0,i}function c(n){var r={},t=n.getAttribute("style"),i;if(t)if(typeof t=="string")t=t.replace(/;$/,"").split(";").forEach(function(n){var t=n.split(":");r[t[0].trim().toLowerCase()]=t[1].trim()});else for(i in t)typeof t[i]!="undefined"&&(r[i.toLowerCase()]=t[i]);return r}function l(n){var f=t.Canvas.activeInstance,e=f?f.getContext():null,i,r,u;if(e)for(i=n.length;i--;)r=n[i].get("fill"),/^url\(/.test(r)&&(u=r.slice(5,r.length-1),t.gradientDefs[u]&&n[i].set("fill",t.Gradient.fromElement(t.gradientDefs[u],e,n[i])))}function a(n,i,r){function h(){--a==0&&(f=f.filter(function(n){return n!=null}),l(f),i(f))}for(var e,f=Array(n.length),a=n.length,o=0,s,v=n.length;o<v;o++)if(s=n[o],e=t[u(s.tagName)],e&&e.fromElement)try{e.async?e.fromElement(s,function(n){return function(t){f.splice(n,0,t);h()}}(o),r):(f.splice(o,0,e.fromElement(s,r)),h())}catch(c){t.log(c.message||c)}else h()}function e(n){for(var r,u=n.getElementsByTagName("style"),t={},i,f=0,e=u.length;f<e;f++)r=u[0].textContent,r=r.replace(/\/\*[\s\S]*?\*\//g,""),i=r.match(/[^{]*\{[\s\S]*?\}/g),i=i.map(function(n){return n.trim()}),i.forEach(function(n){var r=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),n=r[1],o=r[2].trim(),u=o.replace(/;$/,"").split(/\s*;\s*/),i,f;for(t[n]||(t[n]={}),i=0,f=u.length;i<f;i++){var e=u[i].split(/\s*:\s*/),s=e[0],h=e[1];t[n][s]=h}});return t}function v(n){var s=n.nodeName,u=n.getAttribute("class"),f=n.getAttribute("id"),e={},i,o,r;for(i in t.cssRules)if(o=u&&new RegExp("^\\."+u).test(i)||f&&new RegExp("^#"+f).test(i)||new RegExp("^"+s).test(i),o)for(r in t.cssRules[i])e[r]=t.cssRules[i][r];return e}function y(n,i){function u(u){var f=u.responseXML;(!f.documentElement&&t.window.ActiveXObject&&u.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(u.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),f.documentElement)&&t.parseSVGDocument(f.documentElement,function(u,f){r.set(n,{objects:t.util.array.invoke(u,"toObject"),options:f});i(u,f)})}n=n.replace(/^\n\s*/,"").trim();r.has(n,function(f){f?r.get(n,function(n){var t=p(n);i(t.objects,t.options)}):new t.util.request(n,{method:"get",onComplete:u})})}function p(n){var i=n.objects,r=n.options;return i=i.map(function(n){return t[u(n.type)].fromObject(n)}),{objects:i,options:r}}function w(n,i){var u,r;n=n.trim();typeof DOMParser!="undefined"?(u=new DOMParser,u&&u.parseFromString&&(r=u.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(r.documentElement,function(n,t){i(n,t)})}function b(n){for(var i="",t=0,r=n.length;t<r;t++)n[t].type==="text"&&n[t].path&&(i+=["@font-face {","font-family: ",n[t].fontFamily,"; ","src: url('",n[t].path,"')","}"].join(""));return i&&(i=["<defs>",'<style type="text/css">',"<![CDATA[",i,"]\]>","<\/style>","<\/defs>"].join("")),i}var t=n.fabric||(n.fabric={}),i=t.util.object.extend,u=t.util.string.capitalize,o=t.util.object.clone,f={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"},r;t.parseTransformAttribute=function(){function r(n,t){var i=t[0];n[0]=Math.cos(i);n[1]=Math.sin(i);n[2]=-Math.sin(i);n[3]=Math.cos(i)}function u(n,t){var i=t[0],r=t.length===2?t[1]:t[0];n[0]=i;n[3]=r}function f(n,t){n[2]=t[0]}function e(n,t){n[1]=t[0]}function o(n,t){n[4]=t[0];t.length===2&&(n[5]=t[1])}var s=[1,0,0,1,0,0],n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",t="(?:\\s+,?\\s*|,\\s*)",h="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",c="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+t+"("+n+")"+t+"("+n+"))?\\s*\\))",a="(?:(scale)\\s*\\(\\s*("+n+")(?:"+t+"("+n+"))?\\s*\\))",v="(?:(translate)\\s*\\(\\s*("+n+")(?:"+t+"("+n+"))?\\s*\\))",y="(?:(matrix)\\s*\\(\\s*("+n+")"+t+"("+n+")"+t+"("+n+")"+t+"("+n+")"+t+"("+n+")"+t+"("+n+")\\s*\\))",i="(?:"+y+"|"+v+"|"+a+"|"+l+"|"+h+"|"+c+")",p="(?:"+i+"(?:"+t+i+")*)",w="^\\s*(?:"+p+"?)\\s*$",b=new RegExp(w),k=new RegExp(i);return function(n){var t=s.concat();return!n||n&&!b.test(n)?t:(n.replace(k,function(n){var h=new RegExp(i).exec(n).filter(function(n){return n!==""&&n!=null}),c=h[1],s=h.slice(2).map(parseFloat);switch(c){case"translate":o(t,s);break;case"rotate":r(t,s);break;case"scale":u(t,s);break;case"skewX":f(t,s);break;case"skewY":e(t,s);break;case"matrix":t=s}}),t)}}();t.parseSVGDocument=function(){function u(n,t){while(n&&(n=n.parentNode))if(t.test(n.nodeName))return!0;return!1}var i=/^(path|circle|polygon|polyline|ellipse|rect|line|image)$/,n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",r=new RegExp("^\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*$");return function(n,f){var w,s,y,c,b,l,p;if(n){if(w=new Date,s=t.util.toArray(n.getElementsByTagName("*")),s.length===0){for(s=n.selectNodes("//*[name(.)!='svg']"),y=[],c=0,b=s.length;c<b;c++)y[c]=s[c];s=y}if(l=s.filter(function(n){return i.test(n.tagName)&&!u(n,/^(?:pattern|defs)$/)}),l&&(!l||l.length)){var h=n.getAttribute("viewBox"),k=n.getAttribute("width"),d=n.getAttribute("height"),a=null,v=null,g,nt;h&&(h=h.match(r))&&(g=parseInt(h[1],10),nt=parseInt(h[2],10),a=parseInt(h[3],10),v=parseInt(h[4],10));a=k?parseFloat(k):a;v=d?parseFloat(d):v;p={width:a,height:v};t.gradientDefs=t.getGradientDefs(n);t.cssRules=e(n);t.parseElements(l,function(n){t.documentParsingTime=new Date-w;f&&f(n,p)},o(p))}}}}();r={has:function(n,t){t(!1)},get:function(){},set:function(){}};i(t,{parseAttributes:s,parseElements:a,parseStyleAttribute:c,parsePointsAttribute:h,getCSSRules:e,loadSVGFromURL:y,loadSVGFromString:w,createSVGFontFacesMarkup:b})}(typeof exports!="undefined"?exports:this),function(){function t(n){var r=n.getAttribute("style"),t,i;if(r)for(t=r.split(/\s*;\s*/),i=t.length;i--;){var u=t[i].split(/\s*:\s*/),f=u[0].trim(),e=u[1].trim();if(f==="stop-color")return e}}function n(n,t){var i,r;for(i in t)typeof t[i]=="string"&&/^\d+%$/.test(t[i])&&(r=parseFloat(t[i],10),i==="x1"||i==="x2"?t[i]=n.width*r/100:(i==="y1"||i==="y2")&&(t[i]=n.height*r/100)),i==="x1"||i==="x2"?t[i]-=n.width/2:(i==="y1"||i==="y2")&&(t[i]-=n.height/2)}function i(n){for(var u=n.getElementsByTagName("linearGradient"),f=n.getElementsByTagName("radialGradient"),t,r={},i=u.length;i--;)t=u[i],r[t.id]=t;for(i=f.length;i--;)t=f[i],r[t.id]=t;return r}fabric.Gradient={create:function(n,t){var i,f;t||(t={});var e=t.x1||0,o=t.y1||0,s=t.x2||n.canvas.width,h=t.y2||0,r=t.colorStops,u=n.createLinearGradient(e,o,s,h);for(i in r)f=r[i],u.addColorStop(parseFloat(i),f);return u},fromElement:function(i,r,u){for(var o=i.getElementsByTagName("stop"),i,f,s={},e={x1:i.getAttribute("x1")||0,y1:i.getAttribute("y1")||0,x2:i.getAttribute("x2")||"100%",y2:i.getAttribute("y2")||0},h=o.length;h--;)i=o[h],f=i.getAttribute("offset"),f=parseFloat(f)/(/%$/.test(f)?100:1),s[f]=t(i)||i.getAttribute("stop-color");return n(u,e),fabric.Gradient.create(r,{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,colorStops:s})},forObject:function(t,i,r){r||(r={});n(t,r);return fabric.Gradient.create(i,{x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,colorStops:r.colorStops})}};fabric.getGradientDefs=i}(),function(n){"use strict";function t(n,t){arguments.length>0&&this.init(n,t)}var i=n.fabric||(n.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=t;t.prototype={constructor:t,init:function(n,t){this.x=n;this.y=t},add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x==n.x&&this.y==n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){this.x=n;this.y=t},setFromPoint:function(n){this.x=n.x;this.y=n.y},swap:function(n){var t=this.x,i=this.y;this.x=n.x;this.y=n.y;n.x=t;n.y=i}}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){arguments.length>0&&this.init(n)}var i=n.fabric||(n.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}i.Intersection=t;i.Intersection.prototype={init:function(n){this.status=n;this.points=[]},appendPoint:function(n){this.points.push(n)},appendPoints:function(n){this.points=this.points.concat(n)}};i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return s!=0?(o=c/s,h=l/s,0<=o&&o<=1&&0<=h&&h<=1?(e=new t("Intersection"),e.points.push(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t("No Intersection")):e=c==0||l==0?new t("Coincident"):new t("Parallel"),e};i.Intersection.intersectLinePolygon=function(n,i,r){for(var u=new t("No Intersection"),e=r.length,f=0;f<e;f++){var o=r[f],s=r[(f+1)%e],h=t.intersectLineLine(n,i,o,s);u.appendPoints(h.points)}return u.points.length>0&&(u.status="Intersection"),u};i.Intersection.intersectPolygonPolygon=function(n,i){for(var r=new t("No Intersection"),f=n.length,u=0;u<f;u++){var e=n[u],o=n[(u+1)%f],s=t.intersectLinePolygon(e,o,i);r.appendPoints(s.points)}return r.points.length>0&&(r.status="Intersection"),r};i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t("No Intersection");return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}var i=n.fabric||(n.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}i.Color=t;i.Color.prototype={_tryParsingColor:function(n){var i=t.sourceFromHex(n);i||(i=t.sourceFromRgb(n));i&&this.setSource(i)},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHex:function(){var r=this.getSource(),i=r[0].toString(16),n,t;return i=i.length==1?"0"+i:i,n=r[1].toString(16),n=n.length==1?"0"+n:n,t=r[2].toString(16),t=t.length==1?"0"+t:t,i.toUpperCase()+n.toUpperCase()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),r=i[3],n=n||127;return t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){var i;n instanceof t||(n=new t(n));var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource();for(i=0;i<3;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}};i.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))};i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i)return[parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10),i[4]?parseFloat(i[4]):1]};i.Color.fromRgba=t.fromRgb;i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))};i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=i.length===3,u=r?i.charAt(0)+i.charAt(0):i.substring(0,2),f=r?i.charAt(1)+i.charAt(1):i.substring(2,4),e=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(u,16),parseInt(f,16),parseInt(e,16),1]}};i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}}(typeof exports!="undefined"?exports:this),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var t=fabric.util.object.extend,u=fabric.util.getElementOffset,n=fabric.util.removeFromArray,i=fabric.util.removeListener,r=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(n,t){t||(t={});this._initStatic(n,t);fabric.StaticCanvas.activeInstance=this};t(fabric.StaticCanvas.prototype,fabric.Observable);t(fabric.StaticCanvas.prototype,{backgroundColor:"rgba(0, 0, 0, 0)",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:!0,includeDefaultValues:!0,stateful:!0,renderOnAddition:!0,clipTo:null,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:null,_initStatic:function(n,t){this._objects=[];this._createLowerCanvas(n);this._initOptions(t);t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this));t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){return this._offset=u(this.lowerCanvasEl),this},setOverlayImage:function(n,t){return fabric.util.loadImage(n,function(n){this.overlayImage=n;t&&t()},this)},setBackgroundImage:function(n,t,i){return fabric.util.loadImage(n,function(n){this.backgroundImage=n;i&&i.backgroundOpacity&&(this.backgroundOpacity=i.backgroundOpacity);i&&i.backgroundStretch&&(this.backgroundStretch=i.backgroundStretch);t&&t()},this)},_createCanvasElement:function(){var n=fabric.document.createElement("canvas");if(n.style||(n.style={}),!n)throw r;return this._initCanvasElement(n),n},_initCanvasElement:function(n){if(typeof n.getContext=="undefined"&&typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement&&G_vmlCanvasManager.initElement(n),typeof n.getContext=="undefined")throw r;},_initOptions:function(n){for(var t in n)this[t]=n[t];this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"},_createLowerCanvas:function(n){this.lowerCanvasEl=fabric.util.getById(n)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n){return this._setDimension("width",n)},setHeight:function(n){return this._setDimension("height",n)},setDimensions:function(n){for(var t in n)this._setDimension(t,n[t]);return this},_setDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.lowerCanvasEl.style[n]=t+"px",this.upperCanvasEl&&(this.upperCanvasEl[n]=t,this.upperCanvasEl.style[n]=t+"px"),this.wrapperEl&&(this.wrapperEl.style[n]=t+"px"),this[n]=t,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(n,t){t&&t.render(n)},add:function(){this._objects.push.apply(this._objects,arguments);for(var n=arguments.length;n--;)this.stateful&&arguments[n].setupState(),arguments[n].setCoords();return this.renderOnAddition&&this.renderAll(),this},insertAt:function(n,t,i){return i?this._objects[t]=n:this._objects.splice(t,0,n),this.stateful&&n.setupState(),n.setCoords(),this.renderAll(),this},getObjects:function(){return this._objects},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),this},renderAll:function(n){var t=this[n===!0&&this.interactive?"contextTop":"contextContainer"],i,f;this.contextTop&&this.clearContext(this.contextTop);(n===!1||typeof n=="undefined")&&this.clearContext(t);var u=this._objects.length,r=this.getActiveGroup(),e=new Date;if(this.clipTo&&(t.save(),t.beginPath(),this.clipTo(t),t.clip()),t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.width,this.height),typeof this.backgroundImage=="object"&&(t.save(),t.globalAlpha=this.backgroundImageOpacity,this.backgroundImageStretch?t.drawImage(this.backgroundImage,0,0,this.width,this.height):t.drawImage(this.backgroundImage,0,0),t.restore()),u)for(i=0;i<u;++i)(!r||r&&this._objects[i]&&!r.contains(this._objects[i]))&&this._draw(t,this._objects[i]);if(this.clipTo&&t.restore(),r&&this._draw(this.contextTop,r),this.overlayImage&&(this.contextTop||this.contextContainer).drawImage(this.overlayImage,0,0),this.onFpsUpdate){f=new Date-e;this.onFpsUpdate(~~(1e3/f))}return this.fire("after:render"),this},renderTop:function(){this.clearContext(this.contextTop||this.contextContainer);this.overlayImage&&(this.contextTop||this.contextContainer).drawImage(this.overlayImage,0,0);this.selection&&this._groupSelector&&this._drawSelection();var n=this.getActiveGroup();return n&&n.render(this.contextTop),this.fire("after:render"),this},toDataURL:function(n){this.renderAll(!0);var t=(this.upperCanvasEl||this.lowerCanvasEl).toDataURL("image/"+n);return this.renderAll(),t},toDataURLWithMultiplier:function(n,t){var i=this.getWidth(),r=this.getHeight(),e=i*t,o=r*t,u=this.getActiveObject(),f;return this.setWidth(e).setHeight(o),this.contextTop.scale(t,t),u&&this.deactivateAll(),this.width=i,this.height=r,this.renderAll(!0),f=this.toDataURL(n),this.contextTop.scale(1/t,1/t),this.setWidth(i).setHeight(r),u&&this.setActiveObject(u),this.renderAll(),f},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(n){return n.set("left",this.getCenter().left),this.renderAll(),this},centerObjectV:function(n){return n.set("top",this.getCenter().top),this.renderAll(),this},centerObject:function(n){return this.centerObjectH(n).centerObjectV(n)},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(n){var t={objects:this._objects.map(function(t){var i,r;return this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1),r=t[n](),this.includeDefaultValues||(t.includeDefaultValues=i),r},this),background:this.backgroundColor};return this.backgroundImage&&(t.backgroundImage=this.backgroundImage.src,t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch),t},toSVG:function(){var n=['<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" ','"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">',"<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',this.width,'" ','height="',this.height,'" ','xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>",fabric.createSVGFontFacesMarkup(this.getObjects())];this.backgroundImage&&n.push('<image x="0" y="0" ','width="',this.width,'" height="',this.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"><\/image>');for(var t=0,i=this.getObjects(),r=i.length;t<r;t++)n.push(i[t].toSVG());return n.push("<\/svg>"),n.join("")},isEmpty:function(){return this._objects.length===0},remove:function(t){return n(this._objects,t),this.getActiveObject()===t&&this.discardActiveObject(),this.renderAll(),t},sendToBack:function(t){return n(this._objects,t),this._objects.unshift(t),this.renderAll()},bringToFront:function(t){return n(this._objects,t),this._objects.push(t),this.renderAll()},sendBackwards:function(t){var r=this._objects.indexOf(t),u=r,i;if(r!==0){for(i=r-1;i>=0;--i)if(t.intersectsWithObject(this._objects[i])||t.isContainedWithinObject(this._objects[i])){u=i;break}n(this._objects,t);this._objects.splice(u,0,t)}return this.renderAll()},bringForward:function(t){var r=this.getObjects(),u=r.indexOf(t),f=u,i,e;if(u!==r.length-1){for(i=u+1,e=this._objects.length;i<e;++i)if(t.intersectsWithObject(r[i])||t.isContainedWithinObject(this._objects[i])){f=i;break}n(r,t);r.splice(f,0,t)}this.renderAll()},item:function(n){return this.getObjects()[n]},complexity:function(){return this.getObjects().reduce(function(n,t){return n+(t.complexity?t.complexity():0)},0)},forEachObject:function(n,t){for(var i=this.getObjects(),r=i.length;r--;)n.call(t,i[r],r,i);return this},dispose:function(){return this.clear(),this.interactive&&(i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(fabric.window,"resize",this._onResize)),this},_resizeImageToFit:function(n){var t=n.width||n.offsetWidth,i=this.getWidth()/t;t&&(n.width=t*i)}});fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(n){for(var o=n.getContext("2d"),r=o.getImageData(0,0,n.width,n.height),i=r.data,h=r.width,s=r.height,t,u,e,f=0;f<h;f++)for(e=0;e<s;e++)t=f*4*s+e*4,u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u;o.putImageData(r,0,0)},supports:function(n){var t=fabric.document.createElement("canvas"),i;if((typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(t),!t||!t.getContext)||(i=t.getContext("2d"),!i))return null;switch(n){case"getImageData":return typeof i.getImageData!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(typeof exports!="undefined"?exports:this),function(){function y(){}var w=fabric.util.object.extend,i=fabric.util.getPointer,n=fabric.util.addListener,t=fabric.util.removeListener,f={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},e=fabric.util.array.min,o=fabric.util.array.max,s=Math.sqrt,r=Math.pow,h=Math.atan2,c=Math.abs,l=Math.min,a=Math.max,v=.5,p,u;fabric.Canvas=function(n,t){t||(t={});this._initStatic(n,t);this._initInteractive();fabric.Canvas.activeInstance=this};y.prototype=fabric.StaticCanvas.prototype;fabric.Canvas.prototype=new y;p={interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,HOVER_CURSOR:"move",CURSOR:"default",ROTATION_CURSOR:"crosshair",CONTAINER_CLASS:"canvas-container",_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._initWrapperElement();this._createUpperCanvas();this._initEvents();this.calcOffset()},_initEvents:function(){var i=this;this._onMouseDown=function(r){i.__onMouseDown(r);n(fabric.document,"mouseup",i._onMouseUp);fabric.isTouchSupported&&n(fabric.document,"touchend",i._onMouseUp);n(fabric.document,"mousemove",i._onMouseMove);fabric.isTouchSupported&&n(fabric.document,"touchmove",i._onMouseMove);t(i.upperCanvasEl,"mousemove",i._onMouseMove);fabric.isTouchSupported&&t(i.upperCanvasEl,"touchmove",i._onMouseMove)};this._onMouseUp=function(r){i.__onMouseUp(r);t(fabric.document,"mouseup",i._onMouseUp);fabric.isTouchSupported&&t(fabric.document,"touchend",i._onMouseUp);t(fabric.document,"mousemove",i._onMouseMove);fabric.isTouchSupported&&t(fabric.document,"touchmove",i._onMouseMove);n(i.upperCanvasEl,"mousemove",i._onMouseMove);fabric.isTouchSupported&&n(i.upperCanvasEl,"touchmove",i._onMouseMove)};this._onMouseMove=function(n){n.preventDefault&&n.preventDefault();i.__onMouseMove(n)};this._onResize=function(){i.calcOffset()};n(fabric.window,"resize",this._onResize);fabric.isTouchSupported?(n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove)):(n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove))},__onMouseUp:function(n){var u,t,r,i,f;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._finalizeDrawingPath();return}if(this._currentTransform){for(u=this._currentTransform,t=u.target,t._scaling&&(t._scaling=!1),r=this._objects.length;r--;)this._objects[r].setCoords();this.stateful&&t.hasStateChanged()&&(t.isMoving=!1,this.fire("object:modified",{target:t}))}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(n);i=this.getActiveGroup();i&&(i.setObjectsCoords(),i.set("isMoving",!1),this._setCursor(this.CURSOR));this._groupSelector=null;this.renderAll();this._setCursorFromEvent(n,t);this._setCursor("");f=this;setTimeout(function(){f._setCursorFromEvent(n,t)},50);this.fire("mouse:up",{target:t,e:n})},__onMouseDown:function(n){var u="which"in n?n.which==1:n.button==1,r;if(u||fabric.isTouchSupported){if(this.isDrawingMode){this._prepareForDrawing(n);this._captureDrawingPath(n);return}if(!this._currentTransform){var t=this.findTarget(n),i=this.getPointer(n),f=this.getActiveGroup(),e;if(this._shouldClearSelection(n))this._groupSelector={ex:i.x,ey:i.y,top:0,left:0},this.deactivateAllWithDispatch();else{if(this.stateful&&t.saveState(),e=t._findTargetCorner(n,this._offset))this.onBeforeScaleRotate(t);this._setupCurrentTransform(n,t);r=n.shiftKey&&(f||this.getActiveObject())&&this.selection;r?this._handleGroupLogic(n,t):(t!==this.getActiveGroup()&&this.deactivateAll(),this.setActiveObject(t,n))}this.renderAll();this.fire("mouse:down",{target:t,e:n})}}},__onMouseMove:function(n){var r,e,s,t,o;if(this.isDrawingMode){this._isCurrentlyDrawing&&this._captureDrawingPath(n);return}if(r=this._groupSelector,r!==null)e=i(n),r.left=e.x-this._offset.left-r.ex,r.top=e.y-this._offset.top-r.ey,this.renderTop();else if(this._currentTransform){var e=i(n),u=e.x,f=e.y;this._currentTransform.target.isMoving=!0;this._currentTransform.action==="rotate"?(n.shiftKey||(this._rotateObject(u,f),this.fire("object:rotating",{target:this._currentTransform.target})),this._currentTransform.target.hasRotatingPoint||(this._scaleObject(u,f),this.fire("object:scaling",{target:this._currentTransform.target}))):this._currentTransform.action==="scale"?(this._scaleObject(u,f),this.fire("object:scaling",{target:this._currentTransform.target})):this._currentTransform.action==="scaleX"?(this._scaleObject(u,f,"x"),this.fire("object:scaling",{target:this._currentTransform.target})):this._currentTransform.action==="scaleY"?(this._scaleObject(u,f,"y"),this.fire("object:scaling",{target:this._currentTransform.target})):(this._translateObject(u,f),this.fire("object:moving",{target:this._currentTransform.target}));this.renderAll()}else if(s=this.upperCanvasEl.style,t=this.findTarget(n),t)this._setCursorFromEvent(n,t),t.isActive()&&t.setCornersVisibility&&t.setCornersVisibility(!0);else{for(o=this._objects.length;o--;)this._objects[o]&&!this._objects[o].active&&this._objects[o].setActive(!1);s.cursor=this.CURSOR}this.fire("mouse:move",{target:t,e:n})},containsPoint:function(n,t){var u=this.getPointer(n),i=this._normalizePointer(t,u),f=i.x,e=i.y,o=t._getImageLines(t.oCoords),r=t._findCrossPoints(f,e,o);return r&&r%2==1||t._findTargetCorner(n,this._offset)?!0:!1},_normalizePointer:function(n,t){var i=this.getActiveGroup(),r=t.x,u=t.y,f=i&&n.type!=="group"&&i.contains(n);return f&&(r-=i.left,u-=i.top),{x:r,y:u}},_shouldClearSelection:function(n){var t=this.findTarget(n),i=this.getActiveGroup();return!t||t&&i&&!i.contains(t)&&i!==t&&!n.shiftKey},_setupCurrentTransform:function(n,t){var f="drag",r,u=i(n);(r=t._findTargetCorner(n,this._offset))&&(f=r==="ml"||r==="mr"?"scaleX":r==="mt"||r==="mb"?"scaleY":r==="mtr"||r==="mbr"?"rotate":t.hasRotatingPoint?"scale":"rotate");this._currentTransform={target:t,action:f,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:u.x-t.left,offsetY:u.y-t.top,ex:u.x,ey:u.y,left:t.left,top:t.top,theta:t.theta,width:t.width*t.scaleX};this._currentTransform.original={left:t.left,top:t.top}},_handleGroupLogic:function(n,t){var i,r;t.isType("group")&&(t=this.findTarget(n,!0),!t||t.isType("group"))||(i=this.getActiveGroup(),i?(i.contains(t)?(i.remove(t),t.setActive(!1),i.size()===1&&this.discardActiveGroup()):i.add(t),this.fire("selection:created",{target:i,e:n}),i.setActive(!0)):(this._activeObject&&t!==this._activeObject&&(r=new fabric.Group([this._activeObject,t]),this.setActiveGroup(r),i=this.getActiveGroup()),t.setActive(!0)),i&&i.saveCoords())},_prepareForDrawing:function(n){this._isCurrentlyDrawing=!0;this.discardActiveObject().renderAll();var t=this.getPointer(n);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(t.x);this._freeDrawingYPoints.push(t.y);this.contextTop.beginPath();this.contextTop.moveTo(t.x,t.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},_captureDrawingPath:function(n){var t=this.getPointer(n);this._freeDrawingXPoints.push(t.x);this._freeDrawingYPoints.push(t.y);this.contextTop.lineTo(t.x,t.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){var u,n;this.contextTop.closePath();this._isCurrentlyDrawing=!1;var i=e(this._freeDrawingXPoints),r=e(this._freeDrawingYPoints),l=o(this._freeDrawingXPoints),a=o(this._freeDrawingYPoints),v=this.contextTop,t=[],f,s,h=this._freeDrawingXPoints,c=this._freeDrawingYPoints;for(t.push("M ",h[0]-i," ",c[0]-r," "),u=1;f=h[u],s=c[u];u++)t.push("L ",f-i," ",s-r," ");(t=t.join(""),t!=="M 0 0 L 0 0 ")&&(n=new fabric.Path(t),n.fill=null,n.stroke=this.freeDrawingColor,n.strokeWidth=this.freeDrawingLineWidth,this.add(n),n.set("left",i+(l-i)/2).set("top",r+(a-r)/2).setCoords(),this.renderAll(),this.fire("path:created",{path:n}))},_translateObject:function(n,t){var i=this._currentTransform.target;i.lockMovementX||i.set("left",n-this._currentTransform.offsetX);i.lockMovementY||i.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(n,t,i){var f=this._currentTransform,h=this._offset,u=f.target,e,o;u.lockScalingX&&u.lockScalingY||(e=s(r(f.ey-f.top-h.top,2)+r(f.ex-f.left-h.left,2)),o=s(r(t-f.top-h.top,2)+r(n-f.left-h.left,2)),u._scaling=!0,i?i!=="x"||u.lockUniScaling?i!=="y"||u.lockUniScaling||u.lockScalingY||u.set("scaleY",f.scaleY*o/e):u.lockScalingX||u.set("scaleX",f.scaleX*o/e):(u.lockScalingX||u.set("scaleX",f.scaleX*o/e),u.lockScalingY||u.set("scaleY",f.scaleY*o/e)))},_rotateObject:function(n,t){var i=this._currentTransform,r=this._offset,u,f;i.target.lockRotation||(u=h(i.ey-i.top-r.top,i.ex-i.left-r.left),f=h(t-i.top-r.top,n-i.left-r.left),i.target.set("theta",f-u+i.theta))},_setCursor:function(n){this.upperCanvasEl.style.cursor=n},_setCursorFromEvent:function(n,t){var r=this.upperCanvasEl.style,u,i;if(t)if(u=this.getActiveGroup(),i=!!t._findTargetCorner&&(!u||!u.contains(t))&&t._findTargetCorner(n,this._offset),i)if(i in f)r.cursor=f[i];else if(i==="mtr"||i==="mbr")r.cursor=this.ROTATION_CURSOR;else return r.cursor=this.CURSOR,!1;else r.cursor=this.HOVER_CURSOR;else return r.cursor=this.CURSOR,!1;return!0},_drawSelection:function(){var n=this._groupSelector,t=n.left,i=n.top,r=c(t),u=c(i);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(n.ex-(t>0?0:-t),n.ey-(i>0?0:-i),r,u);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(n.ex+v-(t>0?0:r),n.ey+v-(i>0?0:u),r,u)},_findSelectedObjects:function(n){for(var t=[],r=this._groupSelector.ex,u=this._groupSelector.ey,e=r+this._groupSelector.left,o=u+this._groupSelector.top,i,s=new fabric.Point(l(r,e),l(u,o)),h=new fabric.Point(a(r,e),a(u,o)),f=0,c=this._objects.length;f<c;++f)(i=this._objects[f],i)&&(i.intersectsWithRect(s,h)||i.isContainedWithinRect(s,h))&&this.selection&&i.selectable&&(i.setActive(!0),t.push(i));t.length===1?this.setActiveObject(t[0],n):t.length>1&&(t=new fabric.Group(t),this.setActiveGroup(t),t.saveCoords(),this.fire("selection:created",{target:t}));this.renderAll()},findTarget:function(n,t){var i,f=this.getPointer(n),u=this.getActiveGroup(),r;if(u&&!t&&this.containsPoint(n,u))return u;for(r=this._objects.length;r--;)if(this._objects[r]&&this.containsPoint(n,this._objects[r])){i=this._objects[r];this.relatedTarget=i;break}if(i&&i.selectable)return i},getPointer:function(n){var t=i(n);return{x:t.x-this._offset.left,y:t.y-this._offset.top}},_createUpperCanvas:function(){this.upperCanvasEl=this._createCanvasElement();this.upperCanvasEl.className="upper-canvas";this.wrapperEl.appendChild(this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.CONTAINER_CLASS});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.getWidth()||n.width,i=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0});n.width=t;n.height=i;fabric.util.makeElementUnselectable(n)},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(n,t){return this._activeObject&&this._activeObject.setActive(!1),this._activeObject=n,n.setActive(!0),this.renderAll(),this.fire("object:selected",{target:n,e:t}),this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){return this._activeObject&&this._activeObject.setActive(!1),this._activeObject=null,this},setActiveGroup:function(n){return this._activeGroup=n,this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var n=this.getActiveGroup();return n&&n.destroy(),this.setActiveGroup(null)},deactivateAll:function(){for(var t=this.getObjects(),n=0,i=t.length;n<i;n++)t[n].setActive(!1);return this.discardActiveGroup(),this.discardActiveObject(),this},deactivateAllWithDispatch:function(){var n=this.getActiveGroup()||this.getActiveObject();return n&&this.fire("before:selection:cleared",{target:n}),this.deactivateAll(),n&&this.fire("selection:cleared"),this}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString;w(fabric.Canvas.prototype,p);for(u in fabric.StaticCanvas)u!=="prototype"&&(fabric.Canvas[u]=fabric.StaticCanvas[u]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){n.setActive(!1)},onChange:function(t){n.set("opacity",t);r.renderAll();f()},onComplete:function(){r.remove(n);u()}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t){if(n){var i=typeof n=="string"?JSON.parse(n):n;i&&(!i||i.objects)&&(this.clear(),this.backgroundColor=i.background,this._enlivenDatalessObjects(i.objects,t))}},_enlivenDatalessObjects:function(n,t){function i(n,i){u.insertAt(n,i,!0);n.setCoords();++f===r&&t&&t()}var u=this,f=0,r=n.length;r===0&&t&&t();try{n.forEach(function(n,t){var f=n.paths?"paths":"path",r=n[f],u,e,o;if(delete n[f],typeof r!="string")switch(n.type){case"image":fabric[fabric.util.string.capitalize(n.type)].fromObject(n,function(n){i(n,t)});break;default:u=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(n.type))];u&&u.fromObject&&(r&&(n[f]=r),i(u.fromObject(n),t))}else n.type==="image"?fabric.util.loadImage(r,function(u){var f=new fabric.Image(u);f.setSourcePath(r);fabric.util.object.extend(f,n);f.setAngle(n.angle);i(f,t)}):n.type==="text"?(n.path=r,e=fabric.Text.fromObject(n),o=function(){Object.prototype.toString.call(fabric.window.opera)==="[object Opera]"?setTimeout(function(){i(e,t)},500):i(e,t)},fabric.util.getScript(r,o)):fabric.loadSVGFromURL(r,function(u){var f;f=u.length>1?new fabric.PathGroup(u,n):u[0];f.setSourcePath(r);f instanceof fabric.PathGroup||(fabric.util.object.extend(f,n),typeof n.angle!="undefined"&&f.setAngle(n.angle));i(f,t)})},this)}catch(e){fabric.log(e.message)}},loadFromJSON:function(n,t){var i,r;if(n)return(i=JSON.parse(n),!i||i&&!i.objects)?void 0:(this.clear(),r=this,this._enlivenObjects(i.objects,function(){r.backgroundColor=i.background;i.backgroundImage&&(r.setBackgroundImage(i.backgroundImage),r.backgroundImageOpacity=i.backgroundImageOpacity,r.backgroundImageStretch=i.backgroundImageStretch);t&&t()}),this)},_enlivenObjects:function(n,t){var u=0,i=n.filter(function(n){return n.type==="image"}).length,r=this;n.forEach(function(n,f){if(n.type)switch(n.type){case"image":case"font":fabric[fabric.util.string.capitalize(n.type)].fromObject(n,function(n){r.insertAt(n,f,!0);++u===i&&t&&t()});break;default:var e=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(n.type))];e&&e.fromObject&&r.insertAt(e.fromObject(n),f,!0)}});i===0&&t&&t()},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n){var t=JSON.stringify(this);this.cloneWithoutData(function(i){i.loadFromJSON(t,function(){n&&n(i)})})},cloneWithoutData:function(n){var t=fabric.document.createElement("canvas"),i;t.width=this.getWidth();t.height=this.getHeight();i=this.__clone||(this.__clone=new fabric.Canvas(t));i.clipTo=this.clipTo;n&&n(i)}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),v=t.util.object.extend,y=t.util.object.clone,i=t.util.toFixed,h=t.util.string.capitalize,c=t.util.getPointer,l=t.util.degreesToRadians,a=Array.prototype.slice,r,f;if(!t.Object)for(t.Object=t.util.createClass({type:"object",includeDefaultValues:!0,NUM_FRACTION_DIGITS:2,MIN_SCALE_LIMIT:.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix selectable".split(" "),top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,theta:0,opacity:1,angle:0,cornersize:12,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,selectable:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!1,callSuper:function(n){var t=this.constructor.superclass.prototype[n];return arguments.length>1?t.apply(this,a.call(arguments,1)):t.call(this)},initialize:function(n){n&&this.setOptions(n)},setOptions:function(n){for(var i=this.stateProperties.length,t;i--;)t=this.stateProperties[i],t in n&&this.set(t,n[t])},transform:function(n){n.globalAlpha=this.opacity;n.translate(this.left,this.top);n.rotate(this.theta);n.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var n={type:this.type,left:i(this.left,this.NUM_FRACTION_DIGITS),top:i(this.top,this.NUM_FRACTION_DIGITS),width:i(this.width,this.NUM_FRACTION_DIGITS),height:i(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,scaleX:i(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:i(this.scaleY,this.NUM_FRACTION_DIGITS),angle:i(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,this.NUM_FRACTION_DIGITS),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint};return this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(){return this.toObject()},getSvgStyles:function(){return["stroke: ",this.stroke?this.stroke:"none","; ","stroke-width: ",this.strokeWidth?this.strokeWidth:"0","; ","fill: ",this.fill?this.fill:"none","; ","opacity: ",this.opacity?this.opacity:"1",";"].join("")},getSvgTransform:function(){var n=this.getAngle();return["translate(",i(this.left,2)," ",i(this.top,2),")",n!==0?" rotate("+i(n,2)+")":"",this.scaleX===1&&this.scaleY===1?"":" scale("+i(this.scaleX,2)+" "+i(this.scaleY,2)+")"].join("")},_removeDefaultValues:function(n){var i=t.Object.prototype.options;return i&&this.stateProperties.forEach(function(t){n[t]===i[t]&&delete n[t]}),n},isActive:function(){return!!this.active},setActive:function(n){return this.active=!!n,this},toString:function(){return"#<fabric."+h(this.type)+">"},set:function(n,t){var r=(n==="scaleX"||n==="scaleY")&&t<this.MIN_SCALE_LIMIT,i;if(r&&(t=this.MIN_SCALE_LIMIT),typeof n=="object")for(i in n)this.set(i,n[i]);else n==="angle"?this.setAngle(t):this[n]=t;return this},toggle:function(n){var t=this.get(n);return typeof t=="boolean"&&this.set(n,!t),this},setSourcePath:function(n){return this.sourcePath=n,this},get:function(n){return n==="angle"?this.getAngle():this[n]},render:function(n,t){if(this.width!==0&&this.height!==0){n.save();var i=this.transformMatrix;i&&n.setTransform(i[0],i[1],i[2],i[3],i[4],i[5]);t||this.transform(n);this.stroke&&(n.lineWidth=this.strokeWidth,n.strokeStyle=this.stroke);this.overlayFill?n.fillStyle=this.overlayFill:this.fill&&(n.fillStyle=this.fill);this._render(n,t);this.active&&!t&&(this.drawBorders(n),this.hideCorners||this.drawCorners(n));n.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(n){return this.scaleX=n,this.scaleY=n,this},scaleToWidth:function(n){return this.scale(n/this.width)},scaleToHeight:function(n){return this.scale(n/this.height)},setOpacity:function(n){return this.set("opacity",n),this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(n){return this.theta=n/180*Math.PI,this.angle=n,this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var e=Math.cos(this._angle+this.theta)*this._hypotenuse,o=Math.sin(this._angle+this.theta)*this._hypotenuse,f=this.theta,t=Math.sin(f),i=Math.cos(f),n={x:this.left-e,y:this.top-o},r={x:n.x+this.currentWidth*i,y:n.y+this.currentWidth*t},s={x:r.x-this.currentHeight*t,y:r.y+this.currentHeight*i},u={x:n.x-this.currentHeight*t,y:n.y+this.currentHeight*i},h={x:n.x-this.currentHeight/2*t,y:n.y+this.currentHeight/2*i},c={x:n.x+this.currentWidth/2*i,y:n.y+this.currentWidth/2*t},l={x:r.x-this.currentHeight/2*t,y:r.y+this.currentHeight/2*i},a={x:u.x+this.currentWidth/2*i,y:u.y+this.currentWidth/2*t},v={x:n.x+this.currentWidth/2*i,y:n.y+this.currentWidth/2*t},y={x:n.x+this.currentWidth/2*i,y:n.y+this.currentWidth/2*t};return this.oCoords={tl:n,tr:r,br:s,bl:u,ml:h,mt:c,mr:l,mb:a,mtr:v,mbr:y},this._setCornerCoords(),this},drawBorders:function(n){var t,u,e,o,i,r,f,s;if(this.hasBorders)return t=this.padding,u=t*2,n.save(),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=this.borderColor,e=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),o=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY),n.lineWidth=1/this.borderScaleFactor,n.scale(e,o),i=this.getWidth(),r=this.getHeight(),n.strokeRect(~~(-(i/2)-t)+.5,~~(-(r/2)-t)+.5,~~(i+u),~~(r+u)),!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(f=-r/2,s=-i/2,n.beginPath(),n.moveTo(0,f),n.lineTo(0,f-40),n.closePath(),n.stroke()),n.restore(),this},drawCorners:function(n){if(this.hasControls){var s=this.cornersize,l=s/2,a=this.padding,r=-(this.width/2),u=-(this.height/2),t,i,f=s/this.scaleX,e=s/this.scaleY,h=(a+l)/this.scaleY,o=(a+l)/this.scaleX,y=(a+l-s)/this.scaleX,v=(a+l-s)/this.scaleY,c=this.height;return n.save(),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.fillStyle=this.cornerColor,t=r-o,i=u-h,n.fillRect(t,i,f,e),t=r+this.width-o,i=u-h,n.fillRect(t,i,f,e),t=r-o,i=u+c+v,n.fillRect(t,i,f,e),t=r+this.width+y,i=u+c+v,n.fillRect(t,i,f,e),t=r+this.width/2-o,i=u-h,n.fillRect(t,i,f,e),t=r+this.width/2-o,i=u+c+v,n.fillRect(t,i,f,e),t=r+this.width+y,i=u+c/2-h,n.fillRect(t,i,f,e),t=r-o,i=u+c/2-h,n.fillRect(t,i,f,e),this.hasRotatingPoint&&(t=r+this.width/2-o,i=u-45/this.scaleY,n.fillRect(t,i,f,e)),n.restore(),this}},clone:function(n){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(),n):new t.Object(this.toObject())},cloneAsImage:function(n){var i,r;return t.Image&&(i=new Image,i.onload=function(){n&&n(new t.Image(i),r);i=i.onload=null},r={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")},this.set("angle",0).set("flipX",!1).set("flipY",!1),this.toDataURL(function(n){i.src=n})),this},toDataURL:function(n){function u(t){t.left=i.width/2;t.top=i.height/2;t.setActive(!1);r.add(t);var u=r.toDataURL("png");r.dispose();r=t=null;n&&n(u)}var i=t.document.createElement("canvas"),r;i.getContext||typeof G_vmlCanvasManager=="undefined"||G_vmlCanvasManager.initElement(i);i.width=this.getWidth();i.height=this.getHeight();t.util.wrapElement(i,"div");r=new t.Canvas(i);r.backgroundColor="transparent";r.renderAll();this.constructor.async?this.clone(u):u(this.clone())},hasStateChanged:function(){return this.stateProperties.some(function(n){return this[n]!==this.originalState[n]},this)},saveState:function(){return this.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),this},setupState:function(){this.originalState={};this.saveState()},intersectsWithRect:function(n,i){var r=this.oCoords,u=new t.Point(r.tl.x,r.tl.y),f=new t.Point(r.tr.x,r.tr.y),e=new t.Point(r.bl.x,r.bl.y),o=new t.Point(r.br.x,r.br.y),s=t.Intersection.intersectPolygonRectangle([u,f,o,e],n,i);return s.status==="Intersection"},intersectsWithObject:function(n){function u(n){return{tl:new t.Point(n.tl.x,n.tl.y),tr:new t.Point(n.tr.x,n.tr.y),bl:new t.Point(n.bl.x,n.bl.y),br:new t.Point(n.br.x,n.br.y)}}var i=u(this.oCoords),r=u(n.oCoords),f=t.Intersection.intersectPolygonPolygon([i.tl,i.tr,i.br,i.bl],[r.tl,r.tr,r.br,r.bl]);return f.status==="Intersection"},isContainedWithinObject:function(n){return this.isContainedWithinRect(n.oCoords.tl,n.oCoords.br)},isContainedWithinRect:function(n,i){var r=this.oCoords,u=new t.Point(r.tl.x,r.tl.y),f=new t.Point(r.tr.x,r.tr.y),e=new t.Point(r.bl.x,r.bl.y),o=new t.Point(r.br.x,r.br.y);return u.x>n.x&&f.x<i.x&&u.y>n.y&&e.y<i.y},isType:function(n){return this.type===n},_findTargetCorner:function(n,t){var i;if(!this.hasControls)return!1;var u=c(n),e=u.x-t.left,o=u.y-t.top,r,f;for(i in this.oCoords)if(f=this._getImageLines(this.oCoords[i].corner,i),r=this._findCrossPoints(e,o,f),r%2==1&&r!=0)return this.__corner=i,i;return!1},_findCrossPoints:function(n,t,i){var u,e,o,h,f,c,s=0,r;for(var l in i)if((r=i[l],!(r.o.y<t)||!(r.d.y<t))&&(!(r.o.y>=t)||!(r.d.y>=t))&&(r.o.x==r.d.x&&r.o.x>=n?(f=r.o.x,c=t):(u=0,e=(r.d.y-r.o.y)/(r.d.x-r.o.x),o=t-u*n,h=r.o.y-e*r.o.x,f=-(o-h)/(u-e),c=o+u*f),f>=n&&(s+=1),s==2))break;return s},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_setCornerCoords:function(){var n=this.oCoords,o=l(45-this.getAngle()),s=Math.sqrt(2*Math.pow(this.cornersize,2))/2,t=s*Math.cos(o),i=s*Math.sin(o),f=Math.sin(this.theta),e=Math.cos(this.theta),r,u;n.tl.corner={tl:{x:n.tl.x-i,y:n.tl.y-t},tr:{x:n.tl.x+t,y:n.tl.y-i},bl:{x:n.tl.x-t,y:n.tl.y+i},br:{x:n.tl.x+i,y:n.tl.y+t}};n.tr.corner={tl:{x:n.tr.x-i,y:n.tr.y-t},tr:{x:n.tr.x+t,y:n.tr.y-i},br:{x:n.tr.x+i,y:n.tr.y+t},bl:{x:n.tr.x-t,y:n.tr.y+i}};n.bl.corner={tl:{x:n.bl.x-i,y:n.bl.y-t},bl:{x:n.bl.x-t,y:n.bl.y+i},br:{x:n.bl.x+i,y:n.bl.y+t},tr:{x:n.bl.x+t,y:n.bl.y-i}};n.br.corner={tr:{x:n.br.x+t,y:n.br.y-i},bl:{x:n.br.x-t,y:n.br.y+i},br:{x:n.br.x+i,y:n.br.y+t},tl:{x:n.br.x-i,y:n.br.y-t}};n.ml.corner={tl:{x:n.ml.x-i,y:n.ml.y-t},tr:{x:n.ml.x+t,y:n.ml.y-i},bl:{x:n.ml.x-t,y:n.ml.y+i},br:{x:n.ml.x+i,y:n.ml.y+t}};n.mt.corner={tl:{x:n.mt.x-i,y:n.mt.y-t},tr:{x:n.mt.x+t,y:n.mt.y-i},bl:{x:n.mt.x-t,y:n.mt.y+i},br:{x:n.mt.x+i,y:n.mt.y+t}};n.mr.corner={tl:{x:n.mr.x-i,y:n.mr.y-t},tr:{x:n.mr.x+t,y:n.mr.y-i},bl:{x:n.mr.x-t,y:n.mr.y+i},br:{x:n.mr.x+i,y:n.mr.y+t}};n.mb.corner={tl:{x:n.mb.x-i,y:n.mb.y-t},tr:{x:n.mb.x+t,y:n.mb.y-i},bl:{x:n.mb.x-t,y:n.mb.y+i},br:{x:n.mb.x+i,y:n.mb.y+t}};r=40;n.mtr.corner={tl:{x:n.mtr.x-i+f*r,y:n.mtr.y-t-e*r},tr:{x:n.mtr.x+t+f*r,y:n.mtr.y-i-e*r},bl:{x:n.mtr.x-t+f*r,y:n.mtr.y+i-e*r},br:{x:n.mtr.x+i+f*r,y:n.mtr.y+t-e*r}};u=-r-this.currentHeight;n.mbr.corner={tl:{x:n.mbr.x-i+f*u,y:n.mbr.y-t-e*u},tr:{x:n.mbr.x+t+f*u,y:n.mbr.y-i-e*u},bl:{x:n.mbr.x-t+f*u,y:n.mbr.y+i-e*u},br:{x:n.mbr.x+i+f*u,y:n.mbr.y+t-e*u}}},toGrayscale:function(){var n=this.get("fill");return n&&this.set("overlayFill",new t.Color(n).toGrayscale().toRgb()),this},complexity:function(){return 0},toJSON:function(){return this.toObject()},setGradientFill:function(n,i){this.set("fill",t.Gradient.forObject(this,n,i))},animate:function(n,i,r){var u=this;"from"in r||(r.from=this.get(n));/[+-]/.test(i.charAt(0))&&(i=this.get(n)+parseFloat(i));t.util.animate({startValue:r.from,endValue:i,byValue:r.by,easing:r.easing,duration:r.duration,onChange:function(t){u.set(n,t);r.onChange&&r.onChange()},onComplete:function(){u.setCoords();r.onComplete&&r.onComplete()}})}}),t.Object.prototype.rotate=t.Object.prototype.setAngle,r=t.Object.prototype,f=r.stateProperties.length;f--;){var u=r.stateProperties[f],e=u.charAt(0).toUpperCase()+u.slice(1),o="set"+e,s="get"+e;r[s]||(r[s]=function(n){return new Function('return this.get("'+n+'")')}(u));r[o]||(r[o]=function(n){return new Function("value",'return this.set("'+n+'", value)')}(u))}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.Object.prototype.set,u={x1:1,x2:1,y1:1,y2:1};if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",initialize:function(n,t){n||(n=[0,0,0,0]);this.callSuper("initialize",t);this.set("x1",n[0]);this.set("y1",n[1]);this.set("x2",n[2]);this.set("y2",n[3]);this._setWidthHeight()},_setWidthHeight:function(){this.set("width",this.x2-this.x1||1);this.set("height",this.y2-this.y1||1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},set:function(n,t){return r.call(this,n,t),n in u&&this._setWidthHeight(),this},_render:function(n){n.beginPath();n.moveTo(this.width===1?0:-this.width/2,this.height===1?0:-this.height/2);n.lineTo(this.width===1?0:this.width/2,this.height===1?0:this.height/2);n.lineWidth=this.strokeWidth;var t=n.strokeStyle;n.strokeStyle=n.fillStyle;n.stroke();n.strokeStyle=t},complexity:function(){return 1},toObject:function(){return i(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){return["<line ",'x1="',this.get("x1"),'" ','y1="',this.get("y1"),'" ','x2="',this.get("x2"),'" ','y2="',this.get("y2"),'" ','style="',this.getSvgStyles(),'" ',"/>"].join("")}});t.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");t.Line.fromElement=function(n,r){var u=t.parseAttributes(n,t.Line.ATTRIBUTE_NAMES),f=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];return new t.Line(f,i(u,r))};t.Line.fromObject=function(n){var i=[n.x1,n.y1,n.x2,n.y2];return new t.Line(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return"radius"in n&&n.radius>0}var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",initialize:function(n){n=n||{};this.set("radius",n.radius||0);this.callSuper("initialize",n);var t=this.get("radius")*2;this.set("width",t).set("height",t)},toObject:function(){return i(this.callSuper("toObject"),{radius:this.get("radius")})},toSVG:function(){return'<circle cx="0" cy="0" r="'+this.radius+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'},_render:function(n,t){n.beginPath();n.globalAlpha*=this.opacity;n.arc(t?this.left:0,t?this.top:0,this.radius,0,r,!1);n.closePath();this.fill&&n.fill();this.stroke&&n.stroke()},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){this.radius=n;this.set("width",n*2).set("height",n*2)},complexity:function(){return 1}});t.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Circle.fromElement=function(n,r){r||(r={});var f=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES);if(!u(f))throw Error("value of `r` attribute is required and can not be negative");return"left"in f&&(f.left-=r.width/2||0),"top"in f&&(f.top-=r.height/2||0),new t.Circle(i(f,r))};t.Circle.fromObject=function(n){return new t.Circle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("width",n.width||100).set("height",n.height||100)},_render:function(n){var i=this.width/2,t=this.height/2;n.beginPath();n.moveTo(-i,t);n.lineTo(0,-t);n.lineTo(i,t);n.closePath();this.fill&&n.fill();this.stroke&&n.stroke()},complexity:function(){return 1},toSVG:function(){var t=this.width/2,n=this.height/2,i=[-t+" "+n,"0 "+-n,t+" "+n].join(",");return'<polygon points="'+i+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'}});t.Triangle.fromObject=function(n){return new t.Triangle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("rx",n.rx||0);this.set("ry",n.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return i(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){return["<ellipse ",'rx="',this.get("rx"),'" ','ry="',this.get("ry"),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},render:function(n,t){if(this.rx!==0&&this.ry!==0)return this.callSuper("render",n,t)},_render:function(n,t){n.beginPath();n.save();n.globalAlpha*=this.opacity;n.transform(1,0,0,this.ry/this.rx,0,0);n.arc(t?this.left:0,t?this.top:0,this.rx,0,r,!1);this.stroke&&n.stroke();this.fill&&n.fill();n.restore()},complexity:function(){return 1}});t.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Ellipse.fromElement=function(n,r){r||(r={});var u=t.parseAttributes(n,t.Ellipse.ATTRIBUTE_NAMES);return"left"in u&&(u.left-=r.width/2||0),"top"in u&&(u.top-=r.height/2||0),new t.Ellipse(i(u,r))};t.Ellipse.fromObject=function(n){return new t.Ellipse(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function i(n){return n.left=n.left||0,n.top=n.top||0,n}var t=n.fabric||(n.fabric={});if(t.Rect){console.warn("fabric.Rect is already defined");return}t.Rect=t.util.createClass(t.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(n){this._initStateProperties();this.callSuper("initialize",n);this._initRxRy()},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(n){var f=this.rx||0,e=this.ry||0,t=-this.width/2,i=-this.height/2,r=this.width,u=this.height;n.beginPath();n.globalAlpha*=this.opacity;this.group&&n.translate(this.x||0,this.y||0);n.moveTo(t+f,i);n.lineTo(t+r-f,i);n.bezierCurveTo(t+r,i,t+r,i+e,t+r,i+e);n.lineTo(t+r,i+u-e);n.bezierCurveTo(t+r,i+u,t+r-f,i+u,t+r-f,i+u);n.lineTo(t+f,i+u);n.bezierCurveTo(t,i+u,t,i+u-e,t,i+u-e);n.lineTo(t,i+e);n.bezierCurveTo(t,i,t+f,i,t+f,i);n.closePath();this.fill&&n.fill();this.stroke&&n.stroke()},_normalizeLeftTopProperties:function(n){return n.left&&this.set("left",n.left+this.getWidth()/2),this.set("x",n.left||0),n.top&&this.set("top",n.top+this.getHeight()/2),this.set("y",n.top||0),this},complexity:function(){return 1},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{rx:this.get("rx")||0,ry:this.get("ry")||0})},toSVG:function(){return'<rect x="'+this.width/-2+'" y="'+this.height/-2+'" rx="'+this.get("rx")+'" ry="'+this.get("ry")+'" width="'+this.width+'" height="'+this.height+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'" />'}});t.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Rect.fromElement=function(n,r){var u,f;return n?(u=t.parseAttributes(n,t.Rect.ATTRIBUTE_NAMES),u=i(u),f=new t.Rect(t.util.object.extend(r?t.util.object.clone(r):{},u)),f._normalizeLeftTopProperties(u),f):null};t.Rect.fromObject=function(n){return new t.Rect(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",initialize:function(n,t){t=t||{};this.set("points",n);this.callSuper("initialize",t);this._calcDimensions()},_calcDimensions:function(){return t.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return t.Polygon.prototype.toObject.call(this)},toSVG:function(){for(var t=[],n=0,r=this.points.length;n<r;n++)t.push(i(this.points[n].x,2),",",i(this.points[n].y,2)," ");return["<polyline ",'points="',t.join(""),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},_render:function(n){var i,t,r;for(n.beginPath(),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this.fill&&n.fill();this.stroke&&n.stroke()},complexity:function(){return this.get("points").length}});t.Polyline.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Polyline.fromElement=function(n,i){var r,f,u,e;if(!n)return null;for(i||(i={}),r=t.parsePointsAttribute(n.getAttribute("points")),f=t.parseAttributes(n,t.Polyline.ATTRIBUTE_NAMES),u=0,e=r.length;u<e;u++)r[u].x-=i.width/2||0,r[u].y-=i.height/2||0;return new t.Polyline(r,t.util.object.extend(f,i))};t.Polyline.fromObject=function(n){var i=n.points;return new t.Polyline(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,f=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",initialize:function(n,t){t=t||{};this.points=n;this.callSuper("initialize",t);this._calcDimensions()},_calcDimensions:function(){var n=this.points,t=r(n,"x"),i=r(n,"y"),f=u(n,"x"),e=u(n,"y");this.width=f-t;this.height=e-i;this.minX=t;this.minY=i},toObject:function(){return i(this.callSuper("toObject"),{points:this.points.concat()})},toSVG:function(){for(var t=[],n=0,i=this.points.length;n<i;n++)t.push(f(this.points[n].x,2),",",f(this.points[n].y,2)," ");return["<polygon ",'points="',t.join(""),'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',"/>"].join("")},_render:function(n){var i,t,r;for(n.beginPath(),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this.fill&&n.fill();this.stroke&&(n.closePath(),n.stroke())},complexity:function(){return this.points.length}});t.Polygon.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Polygon.fromElement=function(n,r){var u,e,f,o;if(!n)return null;for(r||(r={}),u=t.parsePointsAttribute(n.getAttribute("points")),e=t.parseAttributes(n,t.Polygon.ATTRIBUTE_NAMES),f=0,o=u.length;f<o;f++)u[f].x-=r.width/2||0,u[f].y-=r.height/2||0;return new t.Polygon(u,i(e,r))};t.Polygon.fromObject=function(n){return new t.Polygon(n.points,n)}}(typeof exports!="undefined"?exports:this),function(n){function s(n,t,i,r){for(var e,o=r[0],s=r[1],h=r[2],c=r[3],l=r[4],a=r[5],p=r[6],f=v(a,p,o,s,c,l,h,t,i),u=0;u<f.length;u++)e=y.apply(this,f[u]),n.bezierCurveTo.apply(n,e)}function v(n,t,r,u,e,o,s,c,l){var nt,tt,et,v,yt,pt;if(i=h.call(arguments),f[i])return f[i];var ot=s*(Math.PI/180),y=Math.sin(ot),p=Math.cos(ot);r=Math.abs(r);u=Math.abs(u);var st=p*(c-n)*.5+y*(l-t)*.5,ht=p*(l-t)*.5-y*(c-n)*.5,w=st*st/(r*r)+ht*ht/(u*u);w>1&&(w=Math.sqrt(w),r*=w,u*=w);var ct=p/r,lt=y/r,at=-y/u,vt=p/u,b=ct*c+lt*l,k=at*c+vt*l,d=ct*n+lt*t,g=at*n+vt*t,wt=(d-b)*(d-b)+(g-k)*(g-k),it=1/wt-.25;it<0&&(it=0);nt=Math.sqrt(it);o==e&&(nt=-nt);var rt=.5*(b+d)-nt*(g-k),ut=.5*(k+g)+nt*(d-b),ft=Math.atan2(k-ut,b-rt),bt=Math.atan2(g-ut,d-rt),a=bt-ft;for(a<0&&o==1?a+=2*Math.PI:a>0&&o==0&&(a-=2*Math.PI),tt=Math.ceil(Math.abs(a/(Math.PI*.5+.001))),et=[],v=0;v<tt;v++)yt=ft+v*a/tt,pt=ft+(v+1)*a/tt,et[v]=[rt,ut,yt,pt,r,u,y,p];return f[i]=et}function y(n,t,r,u,f,o,s,c){if(i=h.call(arguments),e[i])return e[i];var a=c*f,v=-s*o,y=s*f,p=c*o,w=.5*(u-r),l=8/3*Math.sin(w*.5)*Math.sin(w*.5)/Math.sin(w),d=n+Math.cos(r)-l*Math.sin(r),g=t+Math.sin(r)+l*Math.cos(r),b=n+Math.cos(u),k=t+Math.sin(u),nt=b+l*Math.sin(u),tt=k-l*Math.cos(u);return e[i]=[a*d+v*g,y*d+p*g,a*nt+v*tt,y*nt+p*tt,a*b+v*k,y*b+p*k]}function r(n){return n[0]==="H"?n[1]:n[n.length-2]}function u(n){return n[0]==="V"?n[1]:n[n.length-1]}var a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},f={},e={},h=Array.prototype.join,i;"use strict";var t=n.fabric||(n.fabric={}),c=t.util.array.min,l=t.util.array.max,o=t.util.object.extend,p=Object.prototype.toString;if(t.Path){t.warn("fabric.Path is already defined");return}if(!t.Object){t.warn("fabric.Path requires fabric.Object");return}t.Path=t.util.createClass(t.Object,{type:"path",initialize:function(n,t){if(t=t||{},this.setOptions(t),!n)throw Error("`path` argument is required");var i=p.call(n)==="[object Array]";(this.path=i?n:n.match&&n.match(/[a-zA-Z][^a-zA-Z]*/g),this.path)&&(i||this._initializeFromArray(t),t.sourcePath&&this.setSourcePath(t.sourcePath))},_initializeFromArray:function(n){var t="width"in n,i="height"in n;this.path=this._parsePath();t&&i||(o(this,this._parseDimensions()),t&&(this.width=n.width),i&&(this.height=n.height))},_render:function(n){for(var t,i=0,r=0,e=0,o=0,h,c,u=-(this.width/2),f=-(this.height/2),l=0,a=this.path.length;l<a;++l){t=this.path[l];switch(t[0]){case"l":i+=t[1];r+=t[2];n.lineTo(i+u,r+f);break;case"L":i=t[1];r=t[2];n.lineTo(i+u,r+f);break;case"h":i+=t[1];n.lineTo(i+u,r+f);break;case"H":i=t[1];n.lineTo(i+u,r+f);break;case"v":r+=t[1];n.lineTo(i+u,r+f);break;case"V":r=t[1];n.lineTo(i+u,r+f);break;case"m":i+=t[1];r+=t[2];n.moveTo(i+u,r+f);break;case"M":i=t[1];r=t[2];n.moveTo(i+u,r+f);break;case"c":h=i+t[5];c=r+t[6];e=i+t[3];o=r+t[4];n.bezierCurveTo(i+t[1]+u,r+t[2]+f,e+u,o+f,h+u,c+f);i=h;r=c;break;case"C":i=t[5];r=t[6];e=t[3];o=t[4];n.bezierCurveTo(t[1]+u,t[2]+f,e+u,o+f,i+u,r+f);break;case"s":h=i+t[3];c=r+t[4];e=2*i-e;o=2*r-o;n.bezierCurveTo(e+u,o+f,i+t[1]+u,r+t[2]+f,h+u,c+f);i=h;r=c;break;case"S":h=t[3];c=t[4];e=2*i-e;o=2*r-o;n.bezierCurveTo(e+u,o+f,t[1]+u,t[2]+f,h+u,c+f);i=h;r=c;break;case"q":i+=t[3];r+=t[4];n.quadraticCurveTo(t[1]+u,t[2]+f,i+u,r+f);break;case"Q":i=t[3];r=t[4];e=t[1];o=t[2];n.quadraticCurveTo(e+u,o+f,i+u,r+f);break;case"T":h=i;c=r;i=t[1];r=t[2];e=-e+2*h;o=-o+2*c;n.quadraticCurveTo(e+u,o+f,i+u,r+f);break;case"a":s(n,i+u,r+f,[t[1],t[2],t[3],t[4],t[5],t[6]+i+u,t[7]+r+f]);i+=t[6];r+=t[7];break;case"A":s(n,i+u,r+f,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+f]);i=t[6];r=t[7];break;case"z":case"Z":n.closePath()}}},render:function(n,t){n.save();var i=this.transformMatrix;i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t||this.transform(n);this.overlayFill?n.fillStyle=this.overlayFill:this.fill&&(n.fillStyle=this.fill);this.stroke&&(n.strokeStyle=this.stroke);n.beginPath();this._render(n);this.fill&&n.fill();this.stroke&&(n.strokeStyle=this.stroke,n.lineWidth=this.strokeWidth,n.lineCap=n.lineJoin="round",n.stroke());!t&&this.active&&(this.drawBorders(n),this.hideCorners||this.drawCorners(n));n.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(){var n=o(this.callSuper("toObject"),{path:this.path});return this.sourcePath&&(n.sourcePath=this.sourcePath),this.transformMatrix&&(n.transformMatrix=this.transformMatrix),n},toDatalessObject:function(){var n=this.toObject();return this.sourcePath&&(n.path=this.sourcePath),delete n.sourcePath,n},toSVG:function(){for(var i,t=[],n=0,r=this.path.length;n<r;n++)t.push(this.path[n].join(" "));return i=t.join(" "),['<g transform="',this.getSvgTransform(),'">',"<path ",'width="',this.width,'" height="',this.height,'" ','d="',i,'" ','style="',this.getSvgStyles(),'" ','transform="translate(',-this.width/2," ",-this.height/2,')" />',"<\/g>"].join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var i,h,c,r,t,l,u=[],f,e,o,s=0,n,v=this.path.length;s<v;s++){for(f=this.path[s],e=f.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/),n=[f.charAt(0)],i=0,h=e.length;i<h;i++)o=parseFloat(e[i]),isNaN(o)||n.push(o);if(c=n[0].toLowerCase(),r=a[c],n.length-1>r)for(t=1,l=n.length;t<l;t+=r)u.push([n[0]].concat(n.slice(t,t+r)));else u.push(n)}return u},_parseDimensions:function(){var t=[],i=[],f,e,o=!1,s,h;this.path.forEach(function(n,c){n[0]!=="H"&&(f=c===0?r(n):r(this.path[c-1]));n[0]!=="V"&&(e=c===0?u(n):u(this.path[c-1]));n[0]===n[0].toLowerCase()&&(o=!0);s=o?f+r(n):n[0]==="V"?f:r(n);h=o?e+u(n):n[0]==="H"?e:u(n);var l=parseInt(s,10);isNaN(l)||t.push(l);l=parseInt(h,10);isNaN(l)||i.push(l)},this);var y=c(t),p=c(i),a=0,v=0,n={top:p-v,left:y-a,bottom:l(i)-v,right:l(t)-a};return n.width=n.right-n.left,n.height=n.bottom-n.top,n}});t.Path.fromObject=function(n){return new t.Path(n.path,n)};t.Path.ATTRIBUTE_NAMES="d fill fill-opacity opacity fill-rule stroke stroke-width transform".split(" ");t.Path.fromElement=function(n,i){var r=t.parseAttributes(n,t.Path.ATTRIBUTE_NAMES);return new t.Path(r.d,o(r,i))}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function s(n){for(var u,i=0,r=n.length;i<r;i++)n[i]instanceof t.Object||(u=e(o(n[i].type)),n[i]=t[u].fromObject(n[i]));return n}var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.invoke,u=t.Object.prototype.set,f=t.Object.prototype.toObject,e=t.util.string.camelize,o=t.util.string.capitalize;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",forceFillOverwrite:!1,initialize:function(n,t){t=t||{};this.paths=n||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(t);this.setCoords();t.sourcePath&&this.setSourcePath(t.sourcePath)},render:function(n){var t,i,r;if(this.stub)n.save(),this.transform(n),this.stub.render(n,!1),this.active&&(this.drawBorders(n),this.drawCorners(n)),n.restore();else{for(n.save(),t=this.transformMatrix,t&&n.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this.transform(n),i=0,r=this.paths.length;i<r;++i)this.paths[i].render(n,!0);this.active&&(this.drawBorders(n),this.hideCorners||this.drawCorners(n));n.restore()}},set:function(n,t){if((n==="fill"||n==="overlayFill")&&this.isSameColor()){this[n]=t;for(var i=this.paths.length;i--;)this.paths[i].set(n,t)}else u.call(this,n,t);return this},toObject:function(){return i(f.call(this),{paths:r(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var n=this.toObject();return this.sourcePath&&(n.paths=this.sourcePath),n},toSVG:function(){for(var i=this.getObjects(),n=["<g ",'width="',this.width,'" ','height="',this.height,'" ','style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],t=0,r=i.length;t<r;t++)n.push(i[t].toSVG());return n.push("<\/g>"),n.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var n=this.getObjects()[0].get("fill");return this.getObjects().every(function(t){return t.get("fill")===n})},complexity:function(){return this.paths.reduce(function(n,t){return n+(t&&t.complexity?t.complexity():0)},0)},toGrayscale:function(){for(var n=this.paths.length;n--;)this.paths[n].toGrayscale();return this},getObjects:function(){return this.paths}});t.PathGroup.fromObject=function(n){var i=s(n.paths);return new t.PathGroup(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,f=t.util.array.invoke,e=t.util.removeFromArray;t.Group||(t.Group=t.util.createClass(t.Object,{type:"group",initialize:function(n,t){this.objects=n||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();t&&i(this,t);this._setOpacityIfSame();this.setCoords(!0);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var n=this.left,t=this.top;this.forEachObject(function(i){var r=i.get("left"),u=i.get("top");i.set("originalLeft",r);i.set("originalTop",u);i.set("left",r-n);i.set("top",u-t);i.setCoords();i.hideCorners=!0},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(n){return this._restoreObjectsState(),this.objects.push(n),n.setActive(!0),this._calcBounds(),this._updateObjectsCoords(),this},remove:function(n){return this._restoreObjectsState(),e(this.objects,n),n.setActive(!1),this._calcBounds(),this._updateObjectsCoords(),this},size:function(){return this.getObjects().length},set:function(n,t){if(typeof t=="function")this.set(n,t(this[n]));else if(n==="fill"||n==="opacity"){var i=this.objects.length;for(this[n]=t;i--;)this.objects[i].set(n,t)}else this[n]=t;return this},contains:function(n){return this.objects.indexOf(n)>-1},toObject:function(){return i(this.callSuper("toObject"),{objects:f(this.objects,"clone")})},render:function(n){var r,i,f,t,u;for(n.save(),this.transform(n),r=Math.max(this.scaleX,this.scaleY),i=0,f=this.objects.length;t=this.objects[i];i++)u=t.borderScaleFactor,t.borderScaleFactor=r,t.render(n),t.borderScaleFactor=u;this.hideBorders||this.drawBorders(n);this.hideCorners||this.drawCorners(n);n.restore();this.setCoords()},item:function(n){return this.getObjects()[n]},complexity:function(){return this.getObjects().reduce(function(n,t){return n+(typeof t.complexity=="function"?t.complexity():0)},0)},_restoreObjectsState:function(){return this.objects.forEach(this._restoreObjectState,this),this},_restoreObjectState:function(n){var i=this.get("left"),r=this.get("top"),t=this.getAngle()*(Math.PI/180),e=n.get("originalLeft"),o=n.get("originalTop"),u=Math.cos(t)*n.get("top")+Math.sin(t)*n.get("left"),f=-Math.sin(t)*n.get("top")+Math.cos(t)*n.get("left");return n.setAngle(n.getAngle()+this.getAngle()),n.set("left",i+f*this.get("scaleX")),n.set("top",r+u*this.get("scaleY")),n.set("scaleX",n.get("scaleX")*this.get("scaleX")),n.set("scaleY",n.get("scaleY")*this.get("scaleY")),n.setCoords(),n.hideCorners=!1,n.setActive(!1),n.setCoords(),this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords()}),this},activateAllObjects:function(){return this.setActive(!0)},setActive:function(n){return this.forEachObject(function(t){t.setActive(n)}),this},forEachObject:t.StaticCanvas.prototype.forEachObject,_setOpacityIfSame:function(){var n=this.getObjects(),t=n[0]?n[0].get("opacity"):1,i=n.every(function(n){return n.get("opacity")===t});i&&(this.opacity=t)},_calcBounds:function(){for(var t=[],i=[],f,e,l,a,n,o,s,h=0,v=this.objects.length,c;h<v;++h){n=this.objects[h];n.setCoords();for(c in n.oCoords)t.push(n.oCoords[c].x),i.push(n.oCoords[c].y)}f=r(t);l=u(t);e=r(i);a=u(i);o=l-f||0;s=a-e||0;this.width=o;this.height=s;this.left=f+o/2||0;this.top=e+s/2||0},containsPoint:function(n){var t=this.get("width")/2,i=this.get("height")/2,r=this.get("left"),u=this.get("top");return r-t<n.x&&r+t>n.x&&u-i<n.y&&u+i>n.y},toGrayscale:function(){for(var n=this.objects.length;n--;)this.objects[n].toGrayscale()}}),t.Group.fromObject=function(n){return new t.Group(n.objects,n)})}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=fabric.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){fabric.warn("fabric.Image is already defined.");return}if(!fabric.Object){fabric.warn("fabric.Object is required for fabric.Image initialization");return}fabric.Image=fabric.util.createClass(fabric.Object,{active:!1,bordervisibility:!1,cornervisibility:!1,type:"image",filters:[],initialize:function(n,t){t||(t={});this.callSuper("initialize",t);this._initElement(n);this._originalImage=this.getElement();this._initConfig(t);t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(n){return this._element=n,this._initConfig(),this},getOriginalSize:function(){var n=this.getElement();return{width:n.width,height:n.height}},setBorderVisibility:function(){this._resetWidthHeight();this._adjustWidthHeightToBorders(showBorder);this.setCoords()},setCornersVisibility:function(n){this.cornervisibility=!!n},render:function(n,t){n.save();t||this.transform(n);this._render(n);this.active&&!t&&(this.drawBorders(n),this.hideCorners||this.drawCorners(n));n.restore()},toObject:function(){return t(this.callSuper("toObject"),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){return'<g transform="'+this.getSvgTransform()+'"><image xlink:href="'+this.getSvgSrc()+'" style="'+this.getSvgStyles()+'" transform="translate('+-this.width/2+" "+-this.height/2+')" width="'+this.width+'" height="'+this.height+'"/><\/g>'},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(n){this.constructor.fromObject(this.toObject(),n)},applyFilters:function(n){var e;if(this.filters.length===0){this.setElement(this._originalImage);n&&n();return}var u=typeof Buffer!="undefined"&&typeof window=="undefined",r=this._originalImage,t=fabric.document.createElement("canvas"),i=u?new(require("canvas").Image):fabric.document.createElement("img"),f=this;return t.getContext||typeof G_vmlCanvasManager=="undefined"||G_vmlCanvasManager.initElement(t),t.width=r.width,t.height=r.height,t.getContext("2d").drawImage(r,0,0),this.filters.forEach(function(n){n&&n.applyTo(t)}),i.onload=function(){f.setElement(i);n&&n();i.onload=t=r=null},i.width=r.width,i.height=r.height,u?(e=t.toDataURL("image/png").replace(/data:image\/png;base64,/,""),i.src=new Buffer(e,"base64"),f.setElement(i),n&&n()):i.src=t.toDataURL("image/png"),this},_render:function(n){n.drawImage(this.getElement(),-this.width/2,-this.height/2,this.width,this.height)},_adjustWidthHeightToBorders:function(n){n?(this.currentBorder=this.borderwidth,this.width+=2*this.currentBorder,this.height+=2*this.currentBorder):this.currentBorder=0},_resetWidthHeight:function(){var n=this.getElement();this.set("width",n.width);this.set("height",n.height)},_initElement:function(n){this.setElement(fabric.util.getById(n));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(n){this.setOptions(n||{});this._setBorder();this._setWidthHeight()},_initFilters:function(n){n.filters&&n.filters.length&&(this.filters=n.filters.map(function(n){return fabric.Image.filters[n.type].fromObject(n)}))},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var n=2*this.currentBorder;this.width=(this.getElement().width||0)+n;this.height=(this.getElement().height||0)+n},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(n,t){var i=fabric.document.createElement("img"),r=n.src;n.width&&(i.width=n.width);n.height&&(i.height=n.height);i.onload=function(){fabric.Image.prototype._initFilters.call(n,n);var r=new fabric.Image(i,n);t&&t(r);i=i.onload=null};i.src=r};fabric.Image.fromURL=function(n,t,i){var r=fabric.document.createElement("img");r.onload=function(){t&&t(new fabric.Image(r,i));r=r.onload=null};r.src=n};fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href".split(" ");fabric.Image.fromElement=function(n,i,r){r||(r={});var u=fabric.parseAttributes(n,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(u["xlink:href"],i,t(u,r))};fabric.Image.async=!0}(typeof exports!="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.get("angle");return n>-225&&n<=-135?-180:n>-135&&n<=-45?-90:n>-45&&n<=45?0:n>45&&n<=135?90:n>135&&n<=225?180:n>225&&n<=315?270:n>315?360:0},straighten:function(){var n=this._getAngleValueForStraighten();return this.setAngle(n),this},fxStraighten:function(n){n=n||{};var i=function(){},r=n.onComplete||i,u=n.onChange||i,t=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){t.setAngle(n);u()},onComplete:function(){t.setCoords();r()},onStart:function(){t.setActive(!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.renderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters={};fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(n){for(var o=n.getContext("2d"),r=o.getImageData(0,0,n.width,n.height),i=r.data,h=r.width,s=r.height,t,u,e,f=0;f<h;f++)for(e=0;e<s;e++)t=f*4*s+e*4,u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u;o.putImageData(r,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale};fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(n){n||(n={});this.threshold=n.threshold||30;this.distance=n.distance||20},applyTo:function(n){for(var h=n.getContext("2d"),c=h.getImageData(0,0,n.width,n.height),i=c.data,l=this.threshold,e=this.distance,o=255-l,s=Math.abs,r,u,f,t=0,a=i.length;t<a;t+=4)r=i[t],u=i[t+1],f=i[t+2],r>o&&u>o&&f>o&&s(r-u)<e&&s(r-f)<e&&s(u-f)<e&&(i[t+3]=1);h.putImageData(c,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,distance:this.distance}}});fabric.Image.filters.RemoveWhite.fromObject=function(n){return new fabric.Image.filters.RemoveWhite(n)};fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,f=i.length,t=0;t<f;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2];r.putImageData(u,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert},function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,u=t.util.object.clone,i=t.util.toFixed;if(t.Text){t.warn("fabric.Text is already defined");return}if(!t.Object){t.warn("fabric.Text requires fabric.Object");return}t.Text=t.util.createClass(t.Object,{fontSize:40,fontWeight:100,fontFamily:"Times_New_Roman",textDecoration:"",textShadow:null,textAlign:"left",fontStyle:"",lineHeight:1.6,strokeStyle:"",strokeWidth:1,backgroundColor:"",path:null,type:"text",initialize:function(n,t){this._initStateProperties();this.text=n;this.setOptions(t);this.theta=this.angle*Math.PI/180;this.width=this.getWidth();this.setCoords()},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat();this.stateProperties.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","strokeStyle","strokeWidth","backgroundColor");t.util.removeFromArray(this.stateProperties,"width")},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(n){var t=Cufon.textOptions||(Cufon.textOptions={}),i;t.left=this.left;t.top=this.top;t.context=n;t.color=this.fill;i=this._initDummyElement();this.transform(n);Cufon.replaceElement(i,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor});this.width=t.width;this.height=t.height;this._totalLineHeight=t.totalLineHeight;this._fontAscent=t.fontAscent;this._boundaries=t.boundaries;this._shadowOffsets=t.shadowOffsets;this._shadows=t.shadows||[];this.setCoords()},_initDummyElement:function(){var n=t.document.createElement("pre"),i=t.document.createElement("div");return i.appendChild(n),typeof G_vmlCanvasManager=="undefined"?n.innerHTML=this.text:n.innerText=this.text.replace(/\r?\n/gi,"\r"),n.style.fontSize=this.fontSize+"px",n.style.letterSpacing="normal",n},render:function(n,t){n.save();this._render(n);!t&&this.active&&(this.drawBorders(n),this.hideCorners||this.drawCorners(n));n.restore()},toObject:function(){return r(this.callSuper("toObject"),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor})},toSVG:function(){var n=this.text.split(/\r?\n/),t=-this._fontAscent-this._fontAscent/5*this.lineHeight,r=-(this.width/2),u=this.height/2-n.length*this.fontSize-this._totalLineHeight,f=this._getSVGTextAndBg(t,r,n),e=this._getSVGShadows(t,n);return u+=this._fontAscent/5*this.lineHeight,['<g transform="',this.getSvgTransform(),'">',f.textBgRects.join(""),"<text ",this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(r,2)," ",i(u,2),')">',e.join(""),f.textSpans.join(""),"<\/text>","<\/g>"].join("")},_getSVGShadows:function(n,r){for(var o=[],u,h,e=1,c,f=0,s=this._shadows.length;f<s;f++)for(u=0,h=r.length;u<h;u++)r[u]!==""?(c=this._boundaries&&this._boundaries[u]?this._boundaries[u].left:0,o.push('<tspan x="',i(c+e+this._shadowOffsets[f][0],2),u===0?'" y':'" dy','="',i(n+(u===0?this._shadowOffsets[f][1]:0),2),'" ',this._getFillAttributes(this._shadows[f].color),">",t.util.string.escapeXml(r[u]),"<\/tspan>"),e=1):e++;return o},_getSVGTextAndBg:function(n,r,u){for(var o=[],s=[],h,e=1,f=0,c=u.length;f<c;f++)(u[f]!==""?(h=this._boundaries&&this._boundaries[f]?i(this._boundaries[f].left,2):0,o.push('<tspan x="',h,'" ',f===0?"y":"dy",'="',i(n*e,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(u[f]),"<\/tspan>"),e=1):e++,this.backgroundColor)&&s.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(r+this._boundaries[f].left,2),'" y="',i(n*f-this.height/2,2),'" width="',i(this._boundaries[f].width,2),'" height="',i(this._boundaries[f].height,2),'"><\/rect>');return{textSpans:o,textBgRects:s}},_getFillAttributes:function(n){var i=n?new t.Color(n):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+n+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},setColor:function(n){return this.set("fill",n),this},setFontsize:function(n){return this.set("fontSize",n),this.setCoords(),this},getText:function(){return this.text},setText:function(n){return this.set("text",n),this.setCoords(),this},set:function(n,t){if(typeof n=="object")for(var i in n)this.set(i,n[i]);else this[n]=t,n==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3"));return this}});t.Text.fromObject=function(n){return new t.Text(n.text,u(n))};t.Text.fromElement=function(){}}(typeof exports!="undefined"?exports:this),function(){function n(n,t,i){var e=u.parse(n),r=f.createClient(80,e.hostname),o=r.request("GET",e.pathname,{host:e.hostname});r.addListener("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.host+":"+r.port):fabric.log(n.message)});o.end();o.on("response",function(n){var r="";t&&n.setEncoding(t);n.on("end",function(){i(r)});n.on("data",function(t){n.statusCode==200&&(r+=t)})})}var t,i;if(typeof document=="undefined"||typeof window=="undefined"){var r=new require("xmldom").DOMParser,u=require("url"),f=require("http"),e=require("canvas"),o=require("canvas").Image;fabric.util.loadImage=function(t,i){n(t,"binary",function(n){var r=new o;r.src=new Buffer(n,"binary");r._src=t;i(r)})};fabric.loadSVGFromURL=function(t,i){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();n(t,"",function(n){var t=(new r).parseFromString(n);fabric.parseSVGDocument(t.documentElement,function(n,t){i(n,t)})})};fabric.util.getScript=function(t,i){n(t,"",function(n){eval(n);i&&i()})};fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){var r=new fabric.Image(i);r._initConfig(n);r._initFilters(n);t(r)})};fabric.createCanvasForNode=function(n,t){var i=fabric.document.createElement("canvas"),r=new e(n||600,t||600),f,u;return i.style={},i.width=r.width,i.height=r.height,f=fabric.Canvas||fabric.StaticCanvas,u=new f(i),u.contextContainer=r.getContext("2d"),u.nodeCanvas=r,u};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.Canvas&&fabric.Canvas.prototype.createPNGStream;t=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(n){return t.call(this),this.nodeCanvas.width=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);i=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(n){return i.call(this),this.nodeCanvas.height=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();